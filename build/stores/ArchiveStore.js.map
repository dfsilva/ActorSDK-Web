{"version":3,"sources":["../../src/stores/ArchiveStore.js"],"names":["ArchiveStore","dispatcher","isLoading","dialogs","archiveChatState","_isAllLoaded","_isInitialLoadingComplete","isArchiveLoading","isAllLoaded","isInitialLoadingComplete","getDialogs","getArchiveChatState","__onDispatch","action","type","ARCHIVE_ADD","peer","key","PROCESSING","__emitChange","ARCHIVE_ADD_SUCCESS","ARCHIVE_ADD_ERROR","FAILURE","ARCHIVE_LOAD","ARCHIVE_LOAD_SUCCESS","response","ARCHIVE_LOAD_MORE","ARCHIVE_LOAD_MORE_SUCCESS","length","push","apply"],"mappings":";;;;AAIA;;AACA;;;;AACA;;;;;;;;+eANA;;;;IAQMA,Y;;;AACJ,wBAAYC,UAAZ,EAAwB;AAAA;;AAAA,iDACtB,kBAAMA,UAAN,CADsB;;AAGtB,UAAKC,SAAL,GAAiB,IAAjB;AACA,UAAKC,OAAL,GAAe,EAAf;AACA,UAAKC,gBAAL,GAAwB,EAAxB;AACA,UAAKC,YAAL,GAAoB,KAApB;AACA,UAAKC,yBAAL,GAAiC,KAAjC;AAPsB;AAQvB;;yBAEDC,gB,+BAAmB;AACjB,WAAO,KAAKL,SAAZ;AACD,G;;yBAEDM,W,0BAAc;AACZ,WAAO,KAAKH,YAAZ;AACD,G;;yBAEDI,wB,uCAA2B;AACzB,WAAO,KAAKH,yBAAZ;AACD,G;;yBAEDI,U,yBAAa;AACX,WAAO,KAAKP,OAAZ;AACD,G;;yBAEDQ,mB,kCAAsB;AACpB,WAAO,KAAKP,gBAAZ;AACD,G;;yBAGDQ,Y,yBAAaC,M,EAAQ;AACnB,YAAOA,OAAOC,IAAd;AACE,WAAK,+BAAYC,WAAjB;AACE,aAAKX,gBAAL,CAAsBS,OAAOG,IAAP,CAAYC,GAAlC,IAAyC,qCAAkBC,UAA3D;AACA,aAAKC,YAAL;AACA;AACF,WAAK,+BAAYC,mBAAjB;AACE,eAAO,KAAKhB,gBAAL,CAAsBS,OAAOG,IAAP,CAAYC,GAAlC,CAAP;AACA,aAAKE,YAAL;AACA;AACF,WAAK,+BAAYE,iBAAjB;AACE,aAAKjB,gBAAL,CAAsBS,OAAOG,IAAP,CAAYC,GAAlC,IAAyC,qCAAkBK,OAA3D;AACA,aAAKH,YAAL;AACA;;AAEF,WAAK,+BAAYI,YAAjB;AACE,aAAKrB,SAAL,GAAiB,IAAjB;AACA,aAAKG,YAAL,GAAoB,KAApB;AACA,aAAKC,yBAAL,GAAiC,KAAjC;AACA,aAAKa,YAAL;AACA;;AAEF,WAAK,+BAAYK,oBAAjB;AACE,aAAKtB,SAAL,GAAiB,KAAjB;AACA,aAAKI,yBAAL,GAAiC,IAAjC;AACA,aAAKH,OAAL,GAAeU,OAAOY,QAAtB;AACA,aAAKN,YAAL;AACA;;AAEF,WAAK,+BAAYO,iBAAjB;AACE,aAAKxB,SAAL,GAAiB,IAAjB;AACA,aAAKiB,YAAL;AACA;;AAEF,WAAK,+BAAYQ,yBAAjB;AACE,aAAKzB,SAAL,GAAiB,KAAjB;AACA,aAAKG,YAAL,GAAoBQ,OAAOY,QAAP,CAAgBG,MAAhB,KAA2B,CAA/C;AACA,aAAKzB,OAAL,CAAa0B,IAAb,CAAkBC,KAAlB,CAAwB,KAAK3B,OAA7B,EAAsCU,OAAOY,QAA7C;AACA,aAAKN,YAAL;AACA;;AAEF;AAxCF;AA0CD,G;;;;;kBAGY,IAAInB,YAAJ,8B","file":"ArchiveStore.js","sourcesContent":["/*\r\n * Copyright (C) 2016 Actor LLC. <https://actor.im>\r\n */\r\n\r\nimport { Store } from 'flux/utils';\r\nimport Dispatcher from '../dispatcher/ActorAppDispatcher';\r\nimport { ActionTypes, AsyncActionStates } from '../constants/ActorAppConstants';\r\n\r\nclass ArchiveStore extends Store {\r\n  constructor(dispatcher) {\r\n    super(dispatcher);\r\n\r\n    this.isLoading = true;\r\n    this.dialogs = [];\r\n    this.archiveChatState = {};\r\n    this._isAllLoaded = false;\r\n    this._isInitialLoadingComplete = false;\r\n  }\r\n\r\n  isArchiveLoading() {\r\n    return this.isLoading;\r\n  }\r\n\r\n  isAllLoaded() {\r\n    return this._isAllLoaded;\r\n  }\r\n\r\n  isInitialLoadingComplete() {\r\n    return this._isInitialLoadingComplete;\r\n  }\r\n\r\n  getDialogs() {\r\n    return this.dialogs;\r\n  }\r\n\r\n  getArchiveChatState() {\r\n    return this.archiveChatState;\r\n  }\r\n\r\n\r\n  __onDispatch(action) {\r\n    switch(action.type) {\r\n      case ActionTypes.ARCHIVE_ADD:\r\n        this.archiveChatState[action.peer.key] = AsyncActionStates.PROCESSING;\r\n        this.__emitChange();\r\n        break;\r\n      case ActionTypes.ARCHIVE_ADD_SUCCESS:\r\n        delete this.archiveChatState[action.peer.key];\r\n        this.__emitChange();\r\n        break;\r\n      case ActionTypes.ARCHIVE_ADD_ERROR:\r\n        this.archiveChatState[action.peer.key] = AsyncActionStates.FAILURE;\r\n        this.__emitChange();\r\n        break;\r\n\r\n      case ActionTypes.ARCHIVE_LOAD:\r\n        this.isLoading = true;\r\n        this._isAllLoaded = false;\r\n        this._isInitialLoadingComplete = false;\r\n        this.__emitChange();\r\n        break;\r\n\r\n      case ActionTypes.ARCHIVE_LOAD_SUCCESS:\r\n        this.isLoading = false;\r\n        this._isInitialLoadingComplete = true;\r\n        this.dialogs = action.response;\r\n        this.__emitChange();\r\n        break;\r\n\r\n      case ActionTypes.ARCHIVE_LOAD_MORE:\r\n        this.isLoading = true;\r\n        this.__emitChange();\r\n        break;\r\n\r\n      case ActionTypes.ARCHIVE_LOAD_MORE_SUCCESS:\r\n        this.isLoading = false;\r\n        this._isAllLoaded = action.response.length === 0;\r\n        this.dialogs.push.apply(this.dialogs, action.response);\r\n        this.__emitChange();\r\n        break;\r\n\r\n      default:\r\n    }\r\n  }\r\n}\r\n\r\nexport default new ArchiveStore(Dispatcher);\r\n"]}