{"version":3,"sources":["../../src/components/Archive.react.js"],"names":["Archive","props","loadArchiveByScroll","state","isAllLoaded","isLoading","threshold","scrollNode","refs","archiveScroll","scrollArea","getElementsByClassName","scrollHeight","scrollTop","loadMoreArchivedDialogs","maxWait","getStores","calculateState","isArchiveLoading","isInitialLoadingComplete","dialogs","getDialogs","componentWillMount","loadArchivedDialogs","componentDidUpdate","scrollContent","setImmediate","render","archiveClassname","dialogsList","dialog","index","counter","peer","key","avatar","placeholder","title","length","contextTypes","intl","object","create","pure"],"mappings":";;;;AAIA;;AACA;;;;AACA;;AACA;;AACA;;;;AACA;;AAEA;;;;AAEA;;;;AAEA;;;;AACA;;;;;;;;;;+eAhBA;;;;IAkBMA,O;;;AACJ,mBAAYC,KAAZ,EAAkB;AAAA;;AAAA,iDAChB,sBAAMA,KAAN,CADgB;;AAAA,UAsClBC,mBAtCkB,GAsCI,sBAAS,YAAM;AAAA,wBACA,MAAKC,KADL;AAAA,UAC3BC,WAD2B,eAC3BA,WAD2B;AAAA,UACdC,SADc,eACdA,SADc;;AAEnC,UAAMC,YAAY,GAAlB;AACA,UAAI,CAACD,SAAD,IAAc,CAACD,WAAnB,EAAgC;AAC9B,YAAMG,aAAa,2BAAY,MAAKC,IAAL,CAAUC,aAAtB,CAAnB;AACA,YAAMC,aAAaH,WAAWI,sBAAX,CAAkC,eAAlC,EAAmD,CAAnD,CAAnB;;AAEA,YAAIJ,WAAWK,YAAX,GAA0BF,WAAWG,SAArC,GAAiDH,WAAWE,YAAX,GAA0BN,SAA/E,EAA0F;AACxF,0CAAsBQ,uBAAtB;AACD;AACF;AACF,KAXqB,EAWnB,CAXmB,EAWhB,EAAEC,SAAS,EAAX,EAXgB,CAtCJ;AAAA;AAEjB;;UAEMC,S,wBAAY;AACjB,WAAO,wBAAP;AACD,G;;UAEMC,c,6BAAiB;AACtB,WAAO;AACLZ,iBAAW,uBAAaa,gBAAb,EADN;AAELC,gCAA0B,uBAAaA,wBAAb,EAFrB;AAGLf,mBAAa,uBAAaA,WAAb,EAHR;AAILgB,eAAS,uBAAaC,UAAb;AAJJ,KAAP;AAMD,G;;oBAMDC,kB,iCAAqB;AACnB,oCAAsBC,mBAAtB;AACD,G;;oBAEDC,kB,iCAAqB;AAAA,iBAC0C,KAAKrB,KAD/C;AAAA,QACXgB,wBADW,UACXA,wBADW;AAAA,QACef,WADf,UACeA,WADf;AAAA,QAC4BC,SAD5B,UAC4BA,SAD5B;;AAEnB,QAAIc,4BAA4B,CAACf,WAA7B,IAA4C,CAACC,SAAjD,EAA4D;AAC1D,UAAME,aAAa,2BAAY,KAAKC,IAAL,CAAUC,aAAtB,CAAnB;AACA,UAAMgB,gBAAgBlB,WAAWI,sBAAX,CAAkC,YAAlC,EAAgD,CAAhD,CAAtB;AACA,UAAIc,cAAcb,YAAd,GAA6BL,WAAWK,YAA5C,EAA0D;AACxDc,qBAAa,YAAM;AACjB,0CAAsBZ,uBAAtB;AACD,SAFD;AAGD;AACF;AACF,G;;oBAeDa,M,qBAAS;AAAA,kBACwB,KAAKxB,KAD7B;AAAA,QACCE,SADD,WACCA,SADD;AAAA,QACYe,OADZ,WACYA,OADZ;;AAEP,QAAMQ,mBAAmB,0BAAW,iBAAX,EAA8B;AACrD,kCAA4BvB;AADyB,KAA9B,CAAzB;;AAIA,QAAMwB,cAAc,iBAAIT,OAAJ,EAAa,UAACU,MAAD,EAASC,KAAT,EAAmB;AAAA,UAC1CC,OAD0C,GACxBF,MADwB,CAC1CE,OAD0C;AAAA,UACjCC,IADiC,GACxBH,MADwB,CACjCG,IADiC;;;AAGlD,aACE;AAAA;AAAA,UAAK,WAAU,kEAAf,EAAkF,KAAKF,KAAvF;AACE;AAAA;AAAA,YAAM,aAAWE,KAAKA,IAAL,CAAUC,GAA3B,EAAkC,WAAU,kBAA5C;AACE;AAAA;AAAA,cAAK,WAAU,oBAAf;AACE;AACE,yBAAU,sBADZ;AAEE,oBAAK,QAFP;AAGE,qBAAOD,KAAKE,MAHd;AAIE,2BAAaF,KAAKG,WAJpB;AAKE,qBAAOH,KAAKI;AALd,cADF;AASIL,wBAAY,CAAZ,GACI;AAAA;AAAA,gBAAK,WAAU,uBAAf;AAAwCA;AAAxC,aADJ,GAEI;AAXR,WADF;AAeE;AAAA;AAAA,cAAK,WAAU,QAAf;AACE;AAAA;AAAA,gBAAI,WAAU,qBAAd;AAAqCC,mBAAKI;AAA1C;AADF;AAfF;AADF,OADF;AAuBD,KA1BmB,CAApB;;AA4BA,WACE;AAAA;AAAA,QAAS,WAAU,MAAnB;AACE;AAAA;AAAA,UAAQ,WAAU,0BAAlB;AACE;AAAA;AAAA;AAAA;AAAA;AADF,OADF;AAIE;AAAA;AAAA,UAAK,WAAU,SAAf;AACE;AAAA;AAAA,YAAS,WAAWT,gBAApB;AACE;AAAA;AAAA,cAAW,KAAI,eAAf,EAA+B,UAAU,KAAK1B,mBAA9C;AACE;AAAA;AAAA,gBAAK,WAAU,2BAAf;AAEIkB,sBAAQkB,MAAR,KAAmB,CAAnB,GACIT,WADJ,GAEI,CAACxB,SAAD,GACI;AAAA;AAAA,kBAAK,WAAU,0EAAf;AACE;AAAA;AAAA;AAAA;AAAA;AADF,eADJ,GAII,IARZ;AAWIA,0BACI;AAAA;AAAA,kBAAK,WAAU,uGAAf;AACE;AAAA;AAAA,oBAAK,WAAU,WAAf;AAA2B,4DAA3B;AAAiC,4DAAjC;AAAuC,4DAAvC;AAA6C,4DAA7C;AAAmD;AAAnD;AADF,eADJ,GAII;AAfR;AADF;AADF;AADF;AAJF,KADF;AA+BD,G;;;;;AArHGL,O,CAkBGuC,Y,GAAe;AACpBC,QAAM,iBAAUC;AADI,C;kBAsGT,iBAAUC,MAAV,CAAiB1C,OAAjB,EAA0B,EAAE2C,MAAM,KAAR,EAA1B,C","file":"Archive.react.js","sourcesContent":["/*\r\n * Copyright (C) 2016 Actor LLC. <https://actor.im>\r\n */\r\n\r\nimport { map, debounce } from 'lodash';\r\nimport React, { Component, PropTypes } from 'react';\r\nimport { findDOMNode } from 'react-dom';\r\nimport { Container } from 'flux/utils';\r\nimport classnames from 'classnames';\r\nimport { Link } from 'react-router';\r\n\r\nimport ArchiveActionCreators from '../actions/ArchiveActionCreators';\r\n\r\nimport ArchiveStore from '../stores/ArchiveStore';\r\n\r\nimport AvatarItem from './common/AvatarItem.react';\r\nimport Scrollbar from './common/Scrollbar.react';\r\n\r\nclass Archive extends Component {\r\n  constructor(props){\r\n    super(props);\r\n  }\r\n\r\n  static getStores() {\r\n    return [ArchiveStore];\r\n  }\r\n\r\n  static calculateState() {\r\n    return {\r\n      isLoading: ArchiveStore.isArchiveLoading(),\r\n      isInitialLoadingComplete: ArchiveStore.isInitialLoadingComplete(),\r\n      isAllLoaded: ArchiveStore.isAllLoaded(),\r\n      dialogs: ArchiveStore.getDialogs()\r\n    }\r\n  }\r\n\r\n  static contextTypes = {\r\n    intl: PropTypes.object\r\n  };\r\n\r\n  componentWillMount() {\r\n    ArchiveActionCreators.loadArchivedDialogs();\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    const { isInitialLoadingComplete, isAllLoaded, isLoading } = this.state;\r\n    if (isInitialLoadingComplete && !isAllLoaded && !isLoading) {\r\n      const scrollNode = findDOMNode(this.refs.archiveScroll);\r\n      const scrollContent = scrollNode.getElementsByClassName('ss-content')[0];\r\n      if (scrollContent.scrollHeight < scrollNode.scrollHeight) {\r\n        setImmediate(() => {\r\n          ArchiveActionCreators.loadMoreArchivedDialogs();\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  loadArchiveByScroll = debounce(() => {\r\n    const { isAllLoaded, isLoading } = this.state;\r\n    const threshold = 100;\r\n    if (!isLoading && !isAllLoaded) {\r\n      const scrollNode = findDOMNode(this.refs.archiveScroll);\r\n      const scrollArea = scrollNode.getElementsByClassName('ss-scrollarea')[0];\r\n\r\n      if (scrollNode.scrollHeight + scrollArea.scrollTop > scrollArea.scrollHeight - threshold) {\r\n        ArchiveActionCreators.loadMoreArchivedDialogs();\r\n      }\r\n    }\r\n  }, 5, { maxWait: 30 });\r\n\r\n  render() {\r\n    const { isLoading, dialogs } = this.state;\r\n    const archiveClassname = classnames('archive-section', {\r\n      'archive-section--loading': isLoading\r\n    });\r\n\r\n    const dialogsList = map(dialogs, (dialog, index) => {\r\n      const { counter, peer } = dialog;\r\n\r\n      return (\r\n        <div className=\"archive-section__list__item col-xs-12 col-sm-6 col-md-4 col-lg-3\" key={index}>\r\n          <Link to={`/im/${peer.peer.key}`} className=\"archive-item row\">\r\n            <div className=\"archive-item__user\">\r\n              <AvatarItem\r\n                className=\"archive-item__avatar\"\r\n                size=\"medium\"\r\n                image={peer.avatar}\r\n                placeholder={peer.placeholder}\r\n                title={peer.title}\r\n              />\r\n              {\r\n                counter !== 0\r\n                  ? <div className=\"archive-item__counter\">{counter}</div>\r\n                  : null\r\n              }\r\n            </div>\r\n            <div className=\"col-xs\">\r\n              <h4 className=\"archive-item__title\">{peer.title}</h4>\r\n            </div>\r\n          </Link>\r\n        </div>\r\n      )\r\n    });\r\n\r\n    return (\r\n      <section className=\"main\">\r\n        <header className=\"toolbar row color--white\">\r\n          <h3>Archive</h3>\r\n        </header>\r\n        <div className=\"flexrow\">\r\n          <section className={archiveClassname}>\r\n            <Scrollbar ref=\"archiveScroll\" onScroll={this.loadArchiveByScroll}>\r\n              <div className=\"archive-section__list row\">\r\n                {\r\n                  dialogs.length !== 0\r\n                    ? dialogsList\r\n                    : !isLoading\r\n                        ? <div className=\"archive-section__list__item archive-section__list__item--empty col-xs-12\">\r\n                            <h3>No dialogs in archive</h3>\r\n                          </div>\r\n                        : null\r\n                }\r\n                {\r\n                  isLoading\r\n                    ? <div className=\"archive-section__list__item archive-section__list__item--loading col-xs-12 col-sm-6 col-md-4 col-lg-3\">\r\n                        <div className=\"preloader\"><div/><div/><div/><div/><div/></div>\r\n                      </div>\r\n                    : null\r\n                }\r\n              </div>\r\n            </Scrollbar>\r\n          </section>\r\n        </div>\r\n      </section>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Container.create(Archive, { pure: false });\r\n"]}