{"version":3,"sources":["../../../../src/components/common/dropdown/MessageActions.react.js"],"names":["MessageActions","props","handleDocumentClick","event","dropdown","refs","dropdownRect","getBoundingClientRect","coords","x","pageX","clientX","y","pageY","clientY","preventDefault","handleDropdownClose","hideMessageDropdown","handleDelete","peer","message","deleteMessage","rid","handleReply","info","getUser","sender","id","replyText","nick","name","pasteText","handleQuote","content","text","shouldComponentUpdate","bind","componentDidMount","listeners","capture","document","componentWillUnmount","forEach","listener","remove","render","targetRect","intl","context","isThisMyMessage","getMyId","dropdownStyles","top","left","dropdownMenuStyles","minWidth","right","messages","TEXT","propTypes","object","isRequired","contextTypes"],"mappings":"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","file":"MessageActions.react.js","sourcesContent":["/*\r\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\r\n */\r\n\r\nimport React, { Component, PropTypes } from 'react';\r\nimport EventListener from 'fbjs/lib/EventListener';\r\nimport { findDOMNode } from 'react-dom';\r\nimport { shouldComponentUpdate } from 'react-addons-pure-render-mixin';\r\n\r\nimport isInside from '../../../utils/isInside';\r\nimport { quoteMessage } from '../../../utils/MessageUtils';\r\n\r\nimport { MessageContentTypes } from '../../../constants/ActorAppConstants';\r\n\r\nimport MessageActionCreators from '../../../actions/MessageActionCreators';\r\nimport ComposeActionCreators from '../../../actions/ComposeActionCreators';\r\nimport DropdownActionCreators from '../../../actions/DropdownActionCreators';\r\n\r\nimport UserStore from '../../../stores/UserStore';\r\n\r\nclass MessageActions extends Component {\r\n  static propTypes = {\r\n    peer: PropTypes.object.isRequired,\r\n    message: PropTypes.object.isRequired,\r\n    targetRect: PropTypes.object.isRequired\r\n  };\r\n\r\n  static contextTypes = {\r\n    intl: PropTypes.object\r\n  };\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.shouldComponentUpdate = shouldComponentUpdate.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.listeners = [\r\n      EventListener.capture(document, 'click', this.handleDocumentClick),\r\n      EventListener.capture(document, 'scroll', this.handleDropdownClose)\r\n    ];\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.listeners.forEach((listener) => {\r\n      listener.remove();\r\n    });\r\n\r\n    this.listeners = null;\r\n  }\r\n\r\n  handleDocumentClick = (event) => {\r\n    const dropdown = findDOMNode(this.refs.dropdown);\r\n    const dropdownRect = dropdown.getBoundingClientRect();\r\n    const coords = {\r\n      x: event.pageX || event.clientX,\r\n      y: event.pageY || event.clientY\r\n    };\r\n\r\n    if (!isInside(coords, dropdownRect)) {\r\n      event.preventDefault();\r\n      this.handleDropdownClose();\r\n    }\r\n  };\r\n\r\n\r\n  handleDropdownClose = () => DropdownActionCreators.hideMessageDropdown();\r\n\r\n  handleDelete = () => {\r\n    const { peer, message } = this.props;\r\n    MessageActionCreators.deleteMessage(peer, message.rid);\r\n    this.handleDropdownClose();\r\n  };\r\n\r\n  handleReply = () => {\r\n    const { message } = this.props;\r\n    const info = UserStore.getUser(message.sender.peer.id);\r\n    const replyText = info.nick ? `@${info.nick}: ` : `${info.name}: `;\r\n    ComposeActionCreators.pasteText(replyText);\r\n    this.handleDropdownClose();\r\n  };\r\n\r\n  handleQuote = () => {\r\n    const { message } = this.props;\r\n    ComposeActionCreators.pasteText(quoteMessage(message.content.text) + '\\n');\r\n    this.handleDropdownClose();\r\n  };\r\n\r\n  render() {\r\n    const { message, targetRect } = this.props;\r\n    const { intl } = this.context;\r\n\r\n    const isThisMyMessage = UserStore.getMyId() === message.sender.peer.id;\r\n\r\n    const dropdownStyles = {\r\n      top: targetRect.top,\r\n      left: targetRect.left\r\n    };\r\n\r\n    const dropdownMenuStyles = {\r\n      minWidth: 120,\r\n      right: 2,\r\n      top: -4\r\n    };\r\n\r\n    return (\r\n      <div className=\"dropdown dropdown--opened dropdown--small\" style={dropdownStyles}>\r\n        <ul className=\"dropdown__menu dropdown__menu--right\" ref=\"dropdown\" style={dropdownMenuStyles}>\r\n          <li className=\"dropdown__menu__item hide\">\r\n            <i className=\"icon material-icons\">star_rate</i> {intl.messages['message.pin']}\r\n          </li>\r\n          {\r\n            !isThisMyMessage\r\n              ? <li className=\"dropdown__menu__item\" onClick={this.handleReply}>\r\n                  <i className=\"icon material-icons\">reply</i> {intl.messages['message.reply']}\r\n                </li>\r\n              : null\r\n          }\r\n          {\r\n            message.content.content === MessageContentTypes.TEXT\r\n              ? <li className=\"dropdown__menu__item\" onClick={this.handleQuote}>\r\n                  <i className=\"icon material-icons\">format_quote</i> {intl.messages['message.quote']}\r\n                </li>\r\n              : null\r\n          }\r\n          <li className=\"dropdown__menu__item hide\">\r\n            <i className=\"icon material-icons\">forward</i> {intl.messages['message.forward']}\r\n          </li>\r\n          <li className=\"dropdown__menu__item\" onClick={this.handleDelete}>\r\n            <i className=\"icon material-icons\">delete</i> {intl.messages['message.delete']}\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default MessageActions;\r\n"]}