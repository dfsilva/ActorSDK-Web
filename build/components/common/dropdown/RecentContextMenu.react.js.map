{"version":3,"sources":["../../../../src/components/common/dropdown/RecentContextMenu.react.js"],"names":["RecentContextMenu","props","handleDocumentClick","event","menu","refs","menuRect","getBoundingClientRect","coords","x","pageX","clientX","y","pageY","clientY","handleClose","hideRecentContext","handleAddToArchive","peer","archiveChat","handleFavorite","favoriteChat","handleUnfavorite","unfavoriteChat","handleDelete","then","deleteChat","shouldComponentUpdate","bind","componentDidMount","listeners","capture","document","componentWillUnmount","forEach","listener","remove","render","contextPos","isFavorite","id","dropdownStyles","top","left","dropdownMenuStyles","minWidth","propTypes","object","isRequired","contextTypes","intl"],"mappings":"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","file":"RecentContextMenu.react.js","sourcesContent":["/*\r\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\r\n */\r\n\r\nimport React, { Component, PropTypes } from 'react';\r\nimport EventListener from 'fbjs/lib/EventListener';\r\nimport { findDOMNode } from 'react-dom';\r\nimport { shouldComponentUpdate } from 'react-addons-pure-render-mixin';\r\nimport { FormattedMessage } from 'react-intl';\r\nimport isInside from '../../../utils/isInside';\r\nimport confirm from '../../../utils/confirm';\r\n\r\nimport DialogStore from '../../../stores/DialogStore';\r\n\r\nimport ArchiveActionCreators from '../../../actions/ArchiveActionCreators';\r\nimport FavoriteActionCreators from '../../../actions/FavoriteActionCreators';\r\nimport DropdownActionCreators from '../../../actions/DropdownActionCreators';\r\nimport DialogActionCreators from '../../../actions/DialogActionCreators';\r\n\r\nclass RecentContextMenu extends Component {\r\n  static propTypes = {\r\n    peer: PropTypes.object.isRequired,\r\n    contextPos: PropTypes.object.isRequired\r\n  };\r\n\r\n  static contextTypes = {\r\n    intl: PropTypes.object\r\n  };\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.shouldComponentUpdate = shouldComponentUpdate.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.listeners = [\r\n      EventListener.capture(document, 'click', this.handleDocumentClick),\r\n      EventListener.capture(document, 'contextmenu', this.handleClose),\r\n      EventListener.capture(document, 'scroll', this.handleClose)\r\n    ];\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.listeners.forEach((listener) => {\r\n      listener.remove();\r\n    });\r\n\r\n    this.listeners = null;\r\n  }\r\n\r\n  handleDocumentClick = (event) => {\r\n    const menu = findDOMNode(this.refs.menu);\r\n    const menuRect = menu.getBoundingClientRect();\r\n    const coords = {\r\n      x: event.pageX || event.clientX,\r\n      y: event.pageY || event.clientY\r\n    };\r\n\r\n    if (!isInside(coords, menuRect)) {\r\n      // event.preventDefault();\r\n      this.handleClose();\r\n    }\r\n  };\r\n\r\n  handleClose = () => DropdownActionCreators.hideRecentContext();\r\n\r\n  handleAddToArchive = () => {\r\n    const { peer } = this.props;\r\n    ArchiveActionCreators.archiveChat(peer);\r\n    this.handleClose();\r\n  };\r\n\r\n  handleFavorite = () => {\r\n    const { peer } = this.props;\r\n    FavoriteActionCreators.favoriteChat(peer);\r\n    this.handleClose();\r\n  };\r\n\r\n  handleUnfavorite = () => {\r\n    const { peer } = this.props;\r\n    FavoriteActionCreators.unfavoriteChat(peer);\r\n    this.handleClose();\r\n  };\r\n\r\n  handleDelete = () => {\r\n    const { peer } = this.props;\r\n    confirm(<FormattedMessage id=\"modal.confirm.delete\"/>).then(\r\n      () => DialogActionCreators.deleteChat(peer),\r\n      () => {}\r\n    );\r\n  };\r\n\r\n  render() {\r\n    const { peer, contextPos } = this.props;\r\n    const isFavorite = DialogStore.isFavorite(peer.id);\r\n\r\n    const dropdownStyles = {\r\n      top: contextPos.y,\r\n      left: contextPos.x\r\n    };\r\n\r\n    const dropdownMenuStyles = {\r\n      minWidth: 140,\r\n      left: 2,\r\n      top: 2\r\n    };\r\n\r\n    return (\r\n      <div className=\"dropdown dropdown--opened dropdown--small\" style={dropdownStyles}>\r\n        <ul className=\"dropdown__menu dropdown__menu--left\" ref=\"menu\" style={dropdownMenuStyles}>\r\n          {\r\n            isFavorite\r\n              ? <li className=\"dropdown__menu__item\" onClick={this.handleUnfavorite}>\r\n                  <i className=\"icon material-icons\">star_border</i> <FormattedMessage id=\"context.favorite.remove\"/>\r\n                </li>\r\n              : <li className=\"dropdown__menu__item\" onClick={this.handleFavorite}>\r\n                  <i className=\"icon material-icons\">star</i> <FormattedMessage id=\"context.favorite.add\"/>\r\n                </li>\r\n          }\r\n          <li className=\"dropdown__menu__item\" onClick={this.handleAddToArchive}>\r\n            <i className=\"icon material-icons\">archive</i> <FormattedMessage id=\"context.archive\"/>\r\n          </li>\r\n          <li className=\"dropdown__menu__item\" onClick={this.handleDelete}>\r\n            <i className=\"icon material-icons\">delete</i> <FormattedMessage id=\"context.delete\"/>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default RecentContextMenu;\r\n"]}