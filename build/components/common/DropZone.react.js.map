{"version":3,"sources":["../../../src/components/common/DropZone.react.js"],"names":["DropZone","props","windowDragging","zoneDragging","state","isActive","isHovered","onWindowDrop","bind","onWindowDragEnter","onWindowDragOver","onWindowDragLeave","onDrop","onDragEnter","onDragOver","onDragLeave","shouldComponentUpdate","nextProps","nextState","componentDidMount","listeners","listen","window","componentWillUnmount","forEach","listener","remove","event","preventDefault","stopPropagation","setState","clearTimeout","windowTimeout","setTimeout","onDropComplete","dataTransfer","files","zoneTimeout","effect","effectAllowed","dropEffect","e","render","className","children","propTypes","node","isRequired","func"],"mappings":"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","file":"DropZone.react.js","sourcesContent":["/*\r\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\r\n */\r\n\r\nimport React, { Component, PropTypes } from 'react';\r\nimport EventListener from 'fbjs/lib/EventListener';\r\nimport classnames from 'classnames';\r\n\r\nclass DropZone extends Component {\r\n  static propTypes = {\r\n    children: PropTypes.node.isRequired,\r\n    onDropComplete: PropTypes.func.isRequired\r\n  };\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.windowDragging = false;\r\n    this.zoneDragging = false;\r\n\r\n    this.state = {\r\n      isActive: false,\r\n      isHovered: false\r\n    };\r\n\r\n    this.onWindowDrop = this.onWindowDrop.bind(this);\r\n    this.onWindowDragEnter = this.onWindowDragEnter.bind(this);\r\n    this.onWindowDragOver = this.onWindowDragOver.bind(this);\r\n    this.onWindowDragLeave = this.onWindowDragLeave.bind(this);\r\n\r\n    this.onDrop = this.onDrop.bind(this);\r\n    this.onDragEnter = this.onDragEnter.bind(this);\r\n    this.onDragOver = this.onDragOver.bind(this);\r\n    this.onDragLeave = this.onDragLeave.bind(this);\r\n  }\r\n\r\n  shouldComponentUpdate(nextProps, nextState) {\r\n    return nextState.isActive !== this.state.isActive ||\r\n           nextState.isHovered !== this.state.isHovered;\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.listeners = [\r\n      EventListener.listen(window, 'drop', this.onWindowDrop),\r\n      EventListener.listen(window, 'dragenter', this.onWindowDragEnter),\r\n      EventListener.listen(window, 'dragover', this.onWindowDragOver),\r\n      EventListener.listen(window, 'dragleave', this.onWindowDragLeave)\r\n    ];\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.listeners.forEach((listener) => {\r\n      listener.remove();\r\n    });\r\n\r\n    this.listeners = null;\r\n  }\r\n\r\n  onWindowDrop(event) {\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n\r\n    this.setState({ isActive: false, isHovered: false });\r\n  }\r\n\r\n  onWindowDragEnter() {\r\n    this.windowDragging = true;\r\n    clearTimeout(this.windowTimeout);\r\n\r\n    if (this.state.isActive) {\r\n      return;\r\n    }\r\n\r\n    this.setState({ isActive: true });\r\n  }\r\n\r\n  onWindowDragOver(event) {\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n\r\n    this.windowDragging = true;\r\n    clearTimeout(this.windowTimeout);\r\n  }\r\n\r\n  onWindowDragLeave() {\r\n    this.windowDragging = false;\r\n    clearTimeout(this.windowTimeout);\r\n\r\n    this.windowTimeout = setTimeout(() => {\r\n      if (!this.windowDragging) {\r\n        this.setState({ isActive: false });\r\n      }\r\n    }, 60);\r\n  }\r\n\r\n  onDrop(event) {\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n\r\n    this.onDragLeave();\r\n    this.onWindowDragLeave();\r\n    this.props.onDropComplete(event.dataTransfer.files);\r\n  }\r\n\r\n  onDragEnter() {\r\n    this.zoneDragging = true;\r\n    this.windowDragging = true;\r\n    clearTimeout(this.zoneTimeout);\r\n    clearTimeout(this.windowTimeout);\r\n\r\n    if (this.state.isHovered) {\r\n      return;\r\n    }\r\n\r\n    this.setState({ isHovered: true });\r\n  }\r\n\r\n  onDragOver(event) {\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n\r\n    this.zoneDragging = true;\r\n    this.windowDragging = true;\r\n    clearTimeout(this.zoneTimeout);\r\n    clearTimeout(this.windowTimeout);\r\n\r\n    // Makes it possible to drag files from chrome's download bar\r\n    // http://stackoverflow.com/questions/19526430/drag-and-drop-file-uploads-from-chrome-downloads-bar\r\n    try {\r\n      const effect = event.dataTransfer.effectAllowed;\r\n      if (effect === 'move' || effect === 'linkMove') {\r\n        event.dataTransfer.dropEffect = 'move';\r\n      } else {\r\n        event.dataTransfer.dropEffect = 'copy';\r\n      }\r\n    } catch (e) {\r\n      // do nothing\r\n    }\r\n  }\r\n\r\n  onDragLeave() {\r\n    this.zoneDragging = false;\r\n    clearTimeout(this.zoneTimeout);\r\n\r\n    this.zoneTimeout = setTimeout(() => {\r\n      if (!this.zoneDragging) {\r\n        this.setState({ isHovered: false });\r\n      }\r\n    }, 60);\r\n  }\r\n\r\n  render() {\r\n    const { isActive, isHovered } = this.state;\r\n\r\n    if (!isActive) {\r\n      return null;\r\n    }\r\n\r\n    const className = classnames('dropzone', {\r\n      'dropzone--hover': isHovered\r\n    });\r\n\r\n    return (\r\n      <div\r\n        className={className}\r\n        onDrop={this.onDrop}\r\n        onDragOver={this.onDragOver}\r\n        onDragEnter={this.onDragEnter}\r\n        onDragLeave={this.onDragLeave}\r\n      >\r\n        {this.props.children}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default DropZone;\r\n"]}