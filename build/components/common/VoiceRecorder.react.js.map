{"version":3,"sources":["../../../src/components/common/VoiceRecorder.react.js"],"names":["isRecordingSupported","VoiceRecorder","props","state","startDate","duration","isRecording","onRecordStart","bind","onRecordStop","onRecordDone","updateDuration","onRecordStarted","shouldComponentUpdate","nextProps","nextState","componentDidMount","recorder","onstart","ondataavailable","componentWillUnmount","start","event","setState","Date","now","timer","setInterval","elapsed","roundElapsed","Math","round","toFixed","stop","clearInterval","typedArray","dataBlob","Blob","type","onFinish","renderDuration","render","className","propTypes","func","isRequired"],"mappings":";;;;AAIA;;;;AACA;;;;AACA;;;;;;;;;;+eANA;;;;AAQA,IAAMA,uBAAuB,uBAASA,oBAAT,EAA7B;;IAEMC,a;;;AAKJ,yBAAYC,KAAZ,EAAmB;AAAA;;AAAA,iDACjB,sBAAMA,KAAN,CADiB;;AAGjB,UAAKC,KAAL,GAAa;AACXC,iBAAW,IADA;AAEXC,gBAAU,CAFC;AAGXC,mBAAa;AAHF,KAAb;;AAMA,UAAKC,aAAL,GAAqB,MAAKA,aAAL,CAAmBC,IAAnB,OAArB;AACA,UAAKC,YAAL,GAAoB,MAAKA,YAAL,CAAkBD,IAAlB,OAApB;AACA,UAAKE,YAAL,GAAoB,MAAKA,YAAL,CAAkBF,IAAlB,OAApB;AACA,UAAKG,cAAL,GAAsB,MAAKA,cAAL,CAAoBH,IAApB,OAAtB;AACA,UAAKI,eAAL,GAAuB,MAAKA,eAAL,CAAqBJ,IAArB,OAAvB;AAbiB;AAclB;;0BAEDK,qB,kCAAsBC,S,EAAWC,S,EAAW;AAC1C,WAAOA,UAAUT,WAAV,KAA0B,KAAKH,KAAL,CAAWG,WAArC,IACAS,UAAUV,QAAV,KAAuB,KAAKF,KAAL,CAAWE,QADzC;AAED,G;;0BAEDW,iB,gCAAoB;AAClB,QAAIhB,oBAAJ,EAA0B;AACxB,WAAKiB,QAAL,GAAgB,4BAAhB;AACA,WAAKA,QAAL,CAAcC,OAAd,GAAwB,KAAKN,eAA7B;AACA,WAAKK,QAAL,CAAcE,eAAd,GAAgC,KAAKT,YAArC;AACD;AACF,G;;0BAEDU,oB,mCAAuB;AACrB,SAAKH,QAAL,CAAcC,OAAd,GAAwB,IAAxB;AACA,SAAKD,QAAL,CAAcE,eAAd,GAAgC,IAAhC;AACA,SAAKF,QAAL,GAAgB,IAAhB;AACD,G;;0BAEDV,a,4BAAgB;AACd,SAAKU,QAAL,CAAcI,KAAd;AACD,G;;0BAEDT,e,4BAAgBU,K,EAAM;AACpB,SAAKC,QAAL,CAAc;AACVnB,iBAAWoB,KAAKC,GAAL,EADD;AAEVpB,gBAAU,CAFA;AAGVC,mBAAa;AAHH,KAAd;AAKA,SAAKoB,KAAL,GAAaC,YAAY,KAAKhB,cAAjB,EAAiC,EAAjC,CAAb;AACD,G;;0BAEDA,c,6BAAgB;AACZ,QAAMiB,UAAU,IAAIJ,IAAJ,KAAa,KAAKrB,KAAL,CAAWC,SAAxC;AACA,QAAIyB,eAAeC,KAAKC,KAAL,CAAWH,UAAU,GAArB,CAAnB;AACA,QAAIvB,WAAW,CAACwB,eAAe,EAAhB,EAAoBG,OAApB,CAA4B,CAA5B,CAAf;AACA,SAAKT,QAAL,CAAc,EAAClB,kBAAD,EAAd;AACH,G;;0BAEDI,Y,yBAAaa,K,EAAO;AAClB,SAAKL,QAAL,CAAcgB,IAAd;AACAC,kBAAc,KAAKR,KAAnB;AACA,SAAKH,QAAL,CAAc,EAAEjB,aAAa,KAAf,EAAd;AACD,G;;0BAEDI,Y,yBAAayB,U,EAAY;AACvB;AACA,QAAM9B,WAAW,KAAKF,KAAL,CAAWE,QAAX,GAAsB,IAAvC;AACA,QAAIA,YAAY,GAAhB,EAAqB;AACnB,UAAM+B,WAAW,IAAIC,IAAJ,CAAU,CAACF,UAAD,CAAV,EAAwB,EAAEG,MAAM,WAAR,EAAxB,CAAjB;AACA,WAAKpC,KAAL,CAAWqC,QAAX,CAAoBlC,QAApB,EAA8B+B,QAA9B;AACD;AACD,SAAKb,QAAL,CAAc,EAAClB,UAAS,CAAV,EAAd;AACD,G;;0BAEDmC,c,6BAAiB;AACf,QAAI,CAAC,KAAKrC,KAAL,CAAWE,QAAhB,EAA0B;AACxB,aAAO,IAAP;AACD;;AAED,WACE;AAAA;AAAA,QAAK,WAAU,0BAAf;AACE;AAAA;AAAA,UAAK,WAAU,8BAAf;AAAA;AACiC,aAAKF,KAAL,CAAWE;AAD5C;AADF,KADF;AAOD,G;;0BAEDoC,M,qBAAS;AACP,QAAI,CAACzC,oBAAL,EAA2B;AACzB,aAAO,IAAP;AACD;;AAED,QAAM0C,YAAY,0BAAW,sBAAX,EAAmC;AACnD,sCAAgC,KAAKvC,KAAL,CAAWG;AADQ,KAAnC,CAAlB;;AAIA,WACE;AAAA;AAAA,QAAK,WAAU,gBAAf;AACE;AAAA;AAAA,UAAM,WAAWoC,SAAjB,EAA4B,aAAa,KAAKnC,aAA9C,EAA6D,WAAW,KAAKE,YAA7E;AACE;AAAA;AAAA,YAAG,WAAU,gBAAb;AAAA;AAAA;AADF,OADF;AAIG,WAAK+B,cAAL;AAJH,KADF;AAQD,G;;;;;AA3GGvC,a,CACG0C,S,GAAY;AACjBJ,YAAU,iBAAUK,IAAV,CAAeC;AADR,C;kBA6GN5C,a","file":"VoiceRecorder.react.js","sourcesContent":["/*\n * Copyright (C) 2015 Actor LLC. <https://actor.im>\n */\n\nimport React, { Component, PropTypes } from 'react';\nimport classNames from 'classnames';\nimport Recorder from 'opus-recorder';\n\nconst isRecordingSupported = Recorder.isRecordingSupported();\n\nclass VoiceRecorder extends Component {\n  static propTypes = {\n    onFinish: PropTypes.func.isRequired\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      startDate: null,\n      duration: 0,\n      isRecording: false\n    };\n\n    this.onRecordStart = this.onRecordStart.bind(this);\n    this.onRecordStop = this.onRecordStop.bind(this);\n    this.onRecordDone = this.onRecordDone.bind(this);\n    this.updateDuration = this.updateDuration.bind(this);\n    this.onRecordStarted = this.onRecordStarted.bind(this);\n  }\n\n  shouldComponentUpdate(nextProps, nextState) {\n    return nextState.isRecording !== this.state.isRecording ||\n           nextState.duration !== this.state.duration;\n  }\n\n  componentDidMount() {\n    if (isRecordingSupported) {\n      this.recorder = new Recorder();\n      this.recorder.onstart = this.onRecordStarted;\n      this.recorder.ondataavailable = this.onRecordDone;\n    }\n  }\n\n  componentWillUnmount() {\n    this.recorder.onstart = null;\n    this.recorder.ondataavailable = null;\n    this.recorder = null;\n  }\n\n  onRecordStart() {\n    this.recorder.start();\n  }\n\n  onRecordStarted(event){\n    this.setState({\n        startDate: Date.now(),\n        duration: 0,\n        isRecording: true\n    });\n    this.timer = setInterval(this.updateDuration, 50);\n  }\n\n  updateDuration(){\n      const elapsed = new Date() - this.state.startDate;\n      var roundElapsed = Math.round(elapsed / 100);\n      var duration = (roundElapsed / 10).toFixed(1);\n      this.setState({duration});\n  }\n\n  onRecordStop(event) {\n    this.recorder.stop();\n    clearInterval(this.timer);\n    this.setState({ isRecording: false});\n  }\n\n  onRecordDone(typedArray) {\n    // duration must be in ms\n    const duration = this.state.duration * 1000;\n    if (duration >= 100) {\n      const dataBlob = new Blob( [typedArray], { type: 'audio/ogg' } );\n      this.props.onFinish(duration, dataBlob);\n    }\n    this.setState({duration:0});\n  }\n\n  renderDuration() {\n    if (!this.state.duration) {\n      return null;\n    }\n\n    return (\n      <div className=\"voice-recorder__duration\">\n        <div className=\"fill row middle-xs center-xs\">\n          Voice message duration:&nbsp; {this.state.duration}\n        </div>\n      </div>\n    );\n  }\n\n  render() {\n    if (!isRecordingSupported) {\n      return null;\n    }\n\n    const className = classNames('voice-recorder__icon', {\n      'voice-recorder__icon--active': this.state.isRecording\n    });\n\n    return (\n      <div className=\"voice-recorder\">\n        <span className={className} onMouseDown={this.onRecordStart} onMouseUp={this.onRecordStop}>\n          <i className=\"material-icons\">mic</i>\n        </span>\n        {this.renderDuration()}\n      </div>\n    );\n  }\n}\n\nexport default VoiceRecorder;\n"]}