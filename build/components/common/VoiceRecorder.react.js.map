{"version":3,"sources":["../../../src/components/common/VoiceRecorder.react.js"],"names":["isRecordingSupported","VoiceRecorder","props","state","startDate","duration","isRecording","onRecordStart","bind","onRecordStop","onRecordDone","updateDuration","onRecordStarted","shouldComponentUpdate","nextProps","nextState","componentDidMount","recorder","onstart","ondataavailable","componentWillUnmount","start","event","setState","Date","now","timer","setInterval","elapsed","roundElapsed","Math","round","toFixed","stop","clearInterval","typedArray","dataBlob","Blob","type","onFinish","renderDuration","render","className","propTypes","func","isRequired"],"mappings":"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","file":"VoiceRecorder.react.js","sourcesContent":["/*\r\n * Copyright (C) 2015 Actor LLC. <https://actor.im>\r\n */\r\n\r\nimport React, { Component, PropTypes } from 'react';\r\nimport classNames from 'classnames';\r\nimport Recorder from 'opus-recorder';\r\n\r\nconst isRecordingSupported = Recorder.isRecordingSupported();\r\n\r\nclass VoiceRecorder extends Component {\r\n  static propTypes = {\r\n    onFinish: PropTypes.func.isRequired\r\n  };\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      startDate: null,\r\n      duration: 0,\r\n      isRecording: false\r\n    };\r\n\r\n    this.onRecordStart = this.onRecordStart.bind(this);\r\n    this.onRecordStop = this.onRecordStop.bind(this);\r\n    this.onRecordDone = this.onRecordDone.bind(this);\r\n    this.updateDuration = this.updateDuration.bind(this);\r\n    this.onRecordStarted = this.onRecordStarted.bind(this);\r\n  }\r\n\r\n  shouldComponentUpdate(nextProps, nextState) {\r\n    return nextState.isRecording !== this.state.isRecording ||\r\n           nextState.duration !== this.state.duration;\r\n  }\r\n\r\n  componentDidMount() {\r\n    if (isRecordingSupported) {\r\n      this.recorder = new Recorder();\r\n      this.recorder.onstart = this.onRecordStarted;\r\n      this.recorder.ondataavailable = this.onRecordDone;\r\n    }\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.recorder.onstart = null;\r\n    this.recorder.ondataavailable = null;\r\n    this.recorder = null;\r\n  }\r\n\r\n  onRecordStart() {\r\n    this.recorder.start();\r\n  }\r\n\r\n  onRecordStarted(event){\r\n    this.setState({\r\n        startDate: Date.now(),\r\n        duration: 0,\r\n        isRecording: true\r\n    });\r\n    this.timer = setInterval(this.updateDuration, 50);\r\n  }\r\n\r\n  updateDuration(){\r\n      const elapsed = new Date() - this.state.startDate;\r\n      var roundElapsed = Math.round(elapsed / 100);\r\n      var duration = (roundElapsed / 10).toFixed(1);\r\n      this.setState({duration});\r\n  }\r\n\r\n  onRecordStop(event) {\r\n    this.recorder.stop();\r\n    clearInterval(this.timer);\r\n    this.setState({ isRecording: false});\r\n  }\r\n\r\n  onRecordDone(typedArray) {\r\n    // duration must be in ms\r\n    const duration = this.state.duration * 1000;\r\n    if (duration >= 100) {\r\n      const dataBlob = new Blob( [typedArray], { type: 'audio/ogg' } );\r\n      this.props.onFinish(duration, dataBlob);\r\n    }\r\n    this.setState({duration:0});\r\n  }\r\n\r\n  renderDuration() {\r\n    if (!this.state.duration) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <div className=\"voice-recorder__duration\">\r\n        <div className=\"fill row middle-xs center-xs\">\r\n          Voice message duration:&nbsp; {this.state.duration}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    if (!isRecordingSupported) {\r\n      return null;\r\n    }\r\n\r\n    const className = classNames('voice-recorder__icon', {\r\n      'voice-recorder__icon--active': this.state.isRecording\r\n    });\r\n\r\n    return (\r\n      <div className=\"voice-recorder\">\r\n        <span className={className} onMouseDown={this.onRecordStart} onMouseUp={this.onRecordStop}>\r\n          <i className=\"material-icons\">mic</i>\r\n        </span>\r\n        {this.renderDuration()}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default VoiceRecorder;\r\n"]}