{"version":3,"sources":["../../../src/components/common/MentionDropdown.react.js"],"names":["DROPDOWN_ITEM_HEIGHT","scrollIndex","MentionDropdown","props","closeMentions","setState","isOpen","onSelect","value","handleScroll","top","menuListNode","refs","mentionList","scrollTop","mentions","state","length","selectedIndex","onKeyDown","bind","onDocumentClick","onDocumentKeyDown","shouldComponentUpdate","componentDidMount","listeners","listen","document","componentWillUnmount","forEach","listener","remove","componentWillReceiveProps","event","onClose","visibleItems","index","keyCode","ENTER","stopPropagation","preventDefault","ARROW_UP","ARROW_DOWN","TAB","ESC","render","className","mentionsElements","mention","itemClassName","peer","avatar","placeholder","title","isNick","mentionText","mentionClassName","propTypes","array","string","func","isRequired"],"mappings":"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","file":"MentionDropdown.react.js","sourcesContent":["/*\r\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\r\n */\r\n\r\nimport { map } from 'lodash';\r\nimport React, { PropTypes, Component } from 'react';\r\nimport EventListener from 'fbjs/lib/EventListener';\r\nimport { findDOMNode } from 'react-dom';\r\nimport classnames from 'classnames';\r\nimport { shouldComponentUpdate } from 'react-addons-pure-render-mixin';\r\n\r\nimport { KeyCodes } from '../../constants/ActorAppConstants';\r\n\r\nimport AvatarItem from './AvatarItem.react';\r\n\r\nconst DROPDOWN_ITEM_HEIGHT = 38;\r\nlet scrollIndex = 0;\r\n\r\nclass MentionDropdown extends Component {\r\n  static propTypes = {\r\n    mentions: PropTypes.array,\r\n    className: PropTypes.string,\r\n    onSelect: PropTypes.func.isRequired,\r\n    onClose: PropTypes.func\r\n  };\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    const { mentions } = props;\r\n\r\n    this.state = {\r\n      isOpen: mentions && mentions.length > 0,\r\n      selectedIndex: 0\r\n    };\r\n\r\n    this.onKeyDown = this.onKeyDown.bind(this);\r\n    this.onDocumentClick = this.onDocumentClick.bind(this);\r\n    this.onDocumentKeyDown = this.onDocumentKeyDown.bind(this);\r\n    this.shouldComponentUpdate = shouldComponentUpdate.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.listeners = [\r\n      EventListener.listen(document, 'click', this.onDocumentClick),\r\n      EventListener.listen(document, 'keydown', this.onDocumentKeyDown)\r\n    ];\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.listeners.forEach((listener) => listener.remove());\r\n    this.listeners = null;\r\n  }\r\n\r\n  componentWillReceiveProps(props) {\r\n    const { mentions } = props;\r\n    this.setState({\r\n      isOpen: mentions && mentions.length > 0,\r\n      selectedIndex: 0\r\n    });\r\n  }\r\n\r\n  onDocumentClick() {\r\n    if (this.state.isOpen) {\r\n      this.closeMentions();\r\n    }\r\n  }\r\n\r\n  onDocumentKeyDown(event) {\r\n    if (this.state.isOpen) {\r\n      this.onKeyDown(event);\r\n    }\r\n  }\r\n\r\n  closeMentions = () => this.setState({ isOpen: false });\r\n\r\n  onSelect = (value) => this.props.onSelect(value);\r\n\r\n  handleScroll = (top) => {\r\n    const menuListNode = findDOMNode(this.refs.mentionList);\r\n    menuListNode.scrollTop = top;\r\n  };\r\n\r\n  onKeyDown(event) {\r\n    const { mentions, onClose } = this.props;\r\n    const { selectedIndex } = this.state;\r\n    const visibleItems = 6;\r\n    let index = selectedIndex;\r\n\r\n    if (index !== null) {\r\n      switch (event.keyCode) {\r\n        case KeyCodes.ENTER:\r\n          event.stopPropagation();\r\n          event.preventDefault();\r\n          this.onSelect(mentions[selectedIndex]);\r\n          break;\r\n\r\n        case KeyCodes.ARROW_UP:\r\n          event.stopPropagation();\r\n          event.preventDefault();\r\n\r\n          if (index > 0) {\r\n            index -= 1;\r\n          } else if (index === 0) {\r\n            index = mentions.length - 1;\r\n          }\r\n\r\n          if (scrollIndex > index) {\r\n            scrollIndex = index;\r\n          } else if (index === mentions.length - 1) {\r\n            scrollIndex = mentions.length - visibleItems;\r\n          }\r\n\r\n          this.handleScroll(scrollIndex * DROPDOWN_ITEM_HEIGHT);\r\n          this.setState({ selectedIndex: index });\r\n          break;\r\n        case KeyCodes.ARROW_DOWN:\r\n        case KeyCodes.TAB:\r\n          event.stopPropagation();\r\n          event.preventDefault();\r\n\r\n          if (index < mentions.length - 1) {\r\n            index += 1;\r\n          } else if (index === mentions.length - 1) {\r\n            index = 0;\r\n          }\r\n\r\n          if (index + 1 > scrollIndex + visibleItems) {\r\n            scrollIndex = index + 1 - visibleItems;\r\n          } else if (index === 0) {\r\n            scrollIndex = 0;\r\n          }\r\n\r\n          this.handleScroll(scrollIndex * DROPDOWN_ITEM_HEIGHT);\r\n          this.setState({ selectedIndex: index });\r\n          break;\r\n        default:\r\n      }\r\n    }\r\n\r\n    if (event.keyCode === KeyCodes.ESC) {\r\n      this.closeMentions();\r\n      if (onClose) onClose();\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { className, mentions } = this.props;\r\n    const { isOpen, selectedIndex } = this.state;\r\n\r\n    if (!isOpen) {\r\n      return <div className=\"mention\" />;\r\n    }\r\n\r\n    const mentionsElements = map(mentions, (mention, index) => {\r\n      const itemClassName = classnames('mention__list__item', {\r\n        'mention__list__item--active': selectedIndex === index\r\n      });\r\n\r\n      return (\r\n        <li className={itemClassName}\r\n            key={index}\r\n            onClick={() => this.onSelect(mention)}\r\n            onMouseOver={() => this.setState({ selectedIndex: index })}>\r\n          <AvatarItem image={mention.peer.avatar}\r\n                      placeholder={mention.peer.placeholder}\r\n                      size=\"tiny\"\r\n                      title={mention.peer.title}/>\r\n          <div className=\"title\">\r\n            {mention.isNick && <span className=\"nickname\">{mention.mentionText}</span>}\r\n            <span className=\"name\">{mention.mentionText}</span>\r\n          </div>\r\n        </li>\r\n      );\r\n    });\r\n\r\n    const mentionClassName = classnames('mention mention--opened', className);\r\n\r\n    return (\r\n      <div className={mentionClassName}>\r\n        <div className=\"mention__wrapper\">\r\n          <header className=\"mention__header\">\r\n            <div className=\"pull-left\"><strong>tab</strong>&nbsp; or &nbsp;<strong>↑</strong><strong>↓</strong>&nbsp; to navigate</div>\r\n            <div className=\"pull-left\"><strong>↵</strong>&nbsp; to select</div>\r\n            <div className=\"pull-right\"><strong>esc</strong>&nbsp; to close</div>\r\n          </header>\r\n          <ul className=\"mention__list\" ref=\"mentionList\">\r\n            {mentionsElements}\r\n          </ul>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default MentionDropdown;\r\n"]}