{"version":3,"sources":["../../../src/components/dialog/MessagesList.react.js"],"names":["MessagesList","props","context","dialog","delegate","components","messages","MessageItem","message","Welcome","welcome","state","showScrollToBottom","dimensions","isLoading","onResize","bind","onScroll","handleScrollToBottom","shouldComponentUpdate","nextProps","nextState","peer","isMember","componentDidMount","restoreScroll","componentWillReceiveProps","equals","updateDimensions","refs","scroller","getDimensions","componentDidUpdate","prevProps","prevState","uid","unreadId","unread","scrollToNode","changeReason","PUSH","_isLastMessageMine","scrollToBottom","UNSHIFT","nextDimensions","scrollTo","scrollHeight","scrollTop","onLoadMore","offsetHeight","setState","ratio","renderHeader","isLoaded","length","renderMessages","overlay","count","selected","receiveDate","readDate","editId","result","index","rid","push","overlayItem","dateDivider","useShort","has","onEdit","onSelect","sortKey","renderScrollToBottomButton","render","contextTypes","object","isRequired","propTypes","number","shape","array","bool","string","oneOf","UNKNOWN","UPDATE","func"],"mappings":"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","file":"MessagesList.react.js","sourcesContent":["/*\r\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\r\n */\r\n\r\nimport { isFunction, throttle } from 'lodash';\r\n\r\nimport React, { Component, PropTypes } from 'react';\r\n\r\nimport { FormattedMessage } from 'react-intl';\r\nimport { MessageChangeReason } from '../../constants/ActorAppConstants';\r\n\r\nimport PeerUtils from '../../utils/PeerUtils';\r\nimport { getMessageState, isLastMessageMine } from '../../utils/MessageUtils';\r\nimport Scroller from '../common/Scroller.react';\r\n\r\nimport DefaultMessageItem from './messages/MessageItem.react';\r\nimport DefaultWelcome from './messages/Welcome.react';\r\nimport Loading from './messages/Loading.react';\r\n\r\nclass MessagesList extends Component {\r\n  static contextTypes = {\r\n    delegate: PropTypes.object.isRequired\r\n  };\r\n\r\n  static propTypes = {\r\n    uid: PropTypes.number.isRequired,\r\n    peer: PropTypes.object.isRequired,\r\n    messages: PropTypes.shape({\r\n      messages: PropTypes.array.isRequired,\r\n      overlay: PropTypes.array.isRequired,\r\n      count: PropTypes.number.isRequired,\r\n      isLoaded: PropTypes.bool.isRequired,\r\n      receiveDate: PropTypes.number.isRequired,\r\n      readDate: PropTypes.number.isRequired,\r\n      editId: PropTypes.string,\r\n      unreadId: PropTypes.string,\r\n      selected: PropTypes.object.isRequired,\r\n      changeReason: PropTypes.oneOf([\r\n        MessageChangeReason.UNKNOWN,\r\n        MessageChangeReason.PUSH,\r\n        MessageChangeReason.UNSHIFT,\r\n        MessageChangeReason.UPDATE\r\n      ]).isRequired\r\n    }).isRequired,\r\n    isMember: PropTypes.bool.isRequired,\r\n    onSelect: PropTypes.func.isRequired,\r\n    onLoadMore: PropTypes.func.isRequired,\r\n    onEdit: PropTypes.func.isRequired\r\n  };\r\n\r\n  constructor(props, context) {\r\n    super(props, context);\r\n\r\n    const { dialog } = context.delegate.components;\r\n    if (dialog && dialog.messages) {\r\n      this.components = {\r\n        MessageItem: isFunction(dialog.messages.message) ? dialog.messages.message : DefaultMessageItem,\r\n        Welcome: isFunction(dialog.messages.welcome) ? dialog.messages.welcome : DefaultWelcome\r\n      };\r\n    } else {\r\n      this.components = {\r\n        MessageItem: DefaultMessageItem,\r\n        Welcome: DefaultWelcome\r\n      };\r\n    }\r\n\r\n    this.state = {\r\n      showScrollToBottom: false\r\n    };\r\n\r\n    this.dimensions = null;\r\n    this.isLoading = false;\r\n\r\n    this.onResize = this.onResize.bind(this);\r\n    this.onScroll = throttle(this.onScroll.bind(this), 300);\r\n    this.handleScrollToBottom = this.handleScrollToBottom.bind(this);\r\n  }\r\n\r\n  shouldComponentUpdate(nextProps, nextState) {\r\n    return nextProps.peer !== this.props.peer ||\r\n           nextProps.messages !== this.props.messages ||\r\n           nextProps.isMember !== this.props.isMember ||\r\n           nextState.showScrollToBottom !== this.state.showScrollToBottom;\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.restoreScroll();\r\n  }\r\n\r\n  componentWillReceiveProps(nextProps) {\r\n    if (!PeerUtils.equals(nextProps.peer, this.props.peer)) {\r\n      this.dimensions = null;\r\n      this.isLoading = false;\r\n    } else {\r\n      this.updateDimensions(this.refs.scroller.getDimensions());\r\n    }\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n    if (prevState.showScrollToBottom !== this.state.showScrollToBottom) {\r\n      return;\r\n    }\r\n\r\n    const { dimensions, refs: { scroller }, props: { uid, messages } } = this;\r\n\r\n    if (messages.unreadId && messages.unreadId !== prevProps.messages.unreadId) {\r\n      if (this.refs.unread) {\r\n        this.refs.scroller.scrollToNode(this.refs.unread);\r\n      }\r\n    } else if (messages.changeReason === MessageChangeReason.PUSH) {\r\n      const _isLastMessageMine = isLastMessageMine(uid, messages);\r\n      if (!dimensions || _isLastMessageMine) {\r\n        this.scrollToBottom();\r\n      }\r\n    } else if (messages.changeReason === MessageChangeReason.UNSHIFT) {\r\n      this.isLoading = false;\r\n      if (dimensions) {\r\n        const nextDimensions = scroller.getDimensions();\r\n        // Restore scroll\r\n        scroller.scrollTo(nextDimensions.scrollHeight - dimensions.scrollHeight);\r\n      } else {\r\n        this.scrollToBottom();\r\n      }\r\n    } else {\r\n      this.restoreScroll();\r\n    }\r\n  }\r\n\r\n  onScroll() {\r\n    const dimensions = this.refs.scroller.getDimensions();\r\n    this.updateDimensions(dimensions);\r\n    if (!this.isLoading && dimensions.scrollTop < 100) {\r\n      this.isLoading = true;\r\n      this.props.onLoadMore();\r\n    }\r\n\r\n    const showScrollToBottom = dimensions.scrollTop < dimensions.scrollHeight - (2 * dimensions.offsetHeight);\r\n\r\n    if (showScrollToBottom !== this.state.showScrollToBottom) {\r\n      this.setState({ showScrollToBottom });\r\n    }\r\n  }\r\n\r\n  onResize() {\r\n    const { dimensions, refs: { scroller } } = this;\r\n    if (dimensions) {\r\n      // Fix scroll\r\n      const ratio = dimensions.scrollTop / dimensions.scrollHeight;\r\n      const nextDimensions = scroller.getDimensions();\r\n      scroller.scrollTo(ratio * nextDimensions.scrollHeight);\r\n      this.dimensions = nextDimensions;\r\n    } else {\r\n      scroller.scrollToBottom();\r\n    }\r\n  }\r\n\r\n  handleScrollToBottom() {\r\n    this.refs.scroller.scrollToBottom();\r\n  }\r\n\r\n  renderHeader() {\r\n    const { peer, isMember, messages } = this.props;\r\n\r\n    if (!isMember) {\r\n      return null;\r\n    }\r\n\r\n    if (messages.isLoaded) {\r\n      const { Welcome } = this.components;\r\n      return <Welcome peer={peer} key=\"header\" />;\r\n    }\r\n\r\n    if (!messages.messages.length) {\r\n      return null;\r\n    }\r\n\r\n    return <Loading key=\"header\" />;\r\n  }\r\n\r\n  renderMessages() {\r\n    const { uid, peer, messages: { messages, overlay, count, selected, receiveDate, readDate, editId, unreadId } } = this.props;\r\n    const { MessageItem } = this.components;\r\n\r\n    const result = [];\r\n    for (let index = messages.length - count; index < messages.length; index++) {\r\n      const message = messages[index];\r\n      if (message.rid === unreadId) {\r\n        result.push(\r\n          <div className=\"unread-divider\" ref=\"unread\" key=\"unread\">\r\n            <div className=\"text\">\r\n              <i className=\"material-icons\">expand_more</i>\r\n              <FormattedMessage id=\"message.unread\"/>\r\n              <i className=\"material-icons\">expand_more</i>\r\n            </div>\r\n          </div>\r\n        );\r\n      }\r\n\r\n      const overlayItem = overlay[index];\r\n      if (overlayItem && overlayItem.dateDivider) {\r\n        result.push(\r\n          <div className=\"date-divider\" key={overlayItem.dateDivider}>\r\n            {overlayItem.dateDivider}\r\n          </div>\r\n        );\r\n      }\r\n\r\n      result.push(\r\n        <MessageItem\r\n          peer={peer}\r\n          message={message}\r\n          state={getMessageState(message, uid, receiveDate, readDate)}\r\n          isShort={overlayItem.useShort}\r\n          isSelected={selected.has(message.rid)}\r\n          isEditing={editId === message.rid}\r\n          onEdit={this.props.onEdit}\r\n          onSelect={this.props.onSelect}\r\n          key={message.sortKey}\r\n        />\r\n      );\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  renderScrollToBottomButton() {\r\n    const { showScrollToBottom } = this.state;\r\n    if (!showScrollToBottom) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <div className=\"chat__scroll-to-bottom\" onClick={this.handleScrollToBottom}>\r\n        <i className=\"material-icons\">keyboard_arrow_down</i>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"chat__container\">\r\n        <Scroller\r\n          className=\"chat__messages\"\r\n          ref=\"scroller\"\r\n          onScroll={this.onScroll}\r\n          onResize={this.onResize}\r\n        >\r\n          {this.renderHeader()}\r\n          {this.renderMessages()}\r\n        </Scroller>\r\n        {this.renderScrollToBottomButton()}\r\n      </div>\r\n    )\r\n  }\r\n\r\n  scrollToBottom() {\r\n    this.dimensions = null;\r\n    this.refs.scroller.scrollToBottom();\r\n  }\r\n\r\n  updateDimensions(dimensions) {\r\n    if (dimensions.scrollHeight === dimensions.scrollTop + dimensions.offsetHeight) {\r\n      // Lock scroll to bottom\r\n      this.dimensions = null;\r\n    } else {\r\n      this.dimensions = dimensions;\r\n    }\r\n  }\r\n\r\n  restoreScroll() {\r\n    const { dimensions, refs: { scroller } } = this;\r\n\r\n    if (dimensions) {\r\n      scroller.scrollTo(dimensions.scrollTop);\r\n    } else {\r\n      scroller.scrollToBottom();\r\n    }\r\n  }\r\n}\r\n\r\nexport default MessagesList;\r\n"]}