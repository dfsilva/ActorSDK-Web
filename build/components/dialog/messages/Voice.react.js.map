{"version":3,"sources":["../../../../src/components/dialog/messages/Voice.react.js"],"names":["cache","Voice","props","humanTime","millis","minutes","Math","floor","seconds","toFixed","handleTimeUpdate","setState","currentTime","audio","duration","handlePlayClick","play","isPlaying","handlePauseClick","pause","handlePlayEnding","handleRewind","event","rewindRect","refs","rewind","getBoundingClientRect","rewindPosition","clientX","left","width","handleLoading","setCached","state","isLoaded","isCached","componentDidMount","fileUrl","createAudioElement","componentDidUpdate","componentWillUnmount","removeEventListener","Audio","volume","addEventListener","render","className","voiceClassName","current","total","progress","opacity","propTypes","string","number","isRequired"],"mappings":"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","file":"Voice.react.js","sourcesContent":["/*\r\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\r\n */\r\n\r\nimport React, { Component, PropTypes } from 'react';\r\nimport { findDOMNode } from 'react-dom';\r\nimport classnames from 'classnames';\r\n\r\nlet cache = [];\r\n\r\n/**\r\n * Class that represents a component for display voice message content\r\n */\r\nclass Voice extends Component {\r\n  static propTypes = {\r\n    fileUrl: PropTypes.string,\r\n    duration: PropTypes.number.isRequired,\r\n    className: PropTypes.string\r\n  };\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      isLoaded: this.isCached(),\r\n      isPlaying: false,\r\n      currentTime: 0,\r\n      duration: props.duration / 1000\r\n    };\r\n  }\r\n\r\n  componentDidMount() {\r\n    const { fileUrl } = this.props;\r\n\r\n    if (fileUrl) {\r\n      this.createAudioElement(fileUrl);\r\n    }\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    const { fileUrl } = this.props;\r\n\r\n    if (fileUrl && !this.isCached()) {\r\n      this.createAudioElement(fileUrl);\r\n    }\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.audio) {\r\n      this.audio.removeEventListener('loadeddata', this.handleLoading);\r\n      this.audio.removeEventListener('timeupdate', this.handleTimeUpdate);\r\n      this.audio.removeEventListener('ended', this.handlePlayEnding);\r\n      this.audio.removeEventListener('canplaythrough', this.handleLoading);\r\n    }\r\n  }\r\n\r\n  createAudioElement(fileUrl) {\r\n    this.audio = new Audio(fileUrl);\r\n    this.audio.volume = 1;\r\n    this.audio.addEventListener('loadeddata', this.handleLoading);\r\n    this.audio.addEventListener('timeupdate', this.handleTimeUpdate);\r\n    this.audio.addEventListener('ended', this.handlePlayEnding);\r\n    this.audio.addEventListener('canplaythrough', this.handleLoading);\r\n    this.setCached();\r\n  }\r\n\r\n  isCached() {\r\n    const { fileUrl } = this.props;\r\n    return cache[fileUrl] === true;\r\n  }\r\n\r\n  setCached() {\r\n    const { fileUrl } = this.props;\r\n    cache[fileUrl] = true;\r\n    this.setState({ isLoaded: cache[fileUrl] });\r\n  }\r\n\r\n  humanTime = (millis) => {\r\n    const minutes = Math.floor(millis / 60000);\r\n    const seconds = ((millis % 60000) / 1000).toFixed(0);\r\n\r\n    return minutes + ':' + (seconds < 10 ? '0' : '') + seconds;\r\n  };\r\n\r\n  handleTimeUpdate = () => {\r\n    this.setState({\r\n      currentTime: this.audio.currentTime,\r\n      duration: this.audio.duration\r\n    })\r\n  };\r\n\r\n  handlePlayClick = () => {\r\n    this.audio.play();\r\n    this.setState({ isPlaying: true })\r\n  };\r\n\r\n  handlePauseClick = () => {\r\n    this.audio.pause();\r\n    this.handlePlayEnding();\r\n  };\r\n\r\n  handlePlayEnding = () => {\r\n    this.setState({ isPlaying: false });\r\n  };\r\n\r\n  handleRewind = (event) => {\r\n    const rewindRect = findDOMNode(this.refs.rewind).getBoundingClientRect();\r\n    const rewindPosition = (event.clientX - rewindRect.left) / rewindRect.width;\r\n\r\n    this.audio.currentTime = this.audio.duration * rewindPosition;\r\n  };\r\n\r\n  handleLoading = () => this.setCached();\r\n\r\n  render() {\r\n    const { className } = this.props;\r\n    const { isPlaying, currentTime, duration, isLoaded } = this.state;\r\n    const voiceClassName = classnames(className, 'row');\r\n\r\n    const current = this.humanTime(currentTime * 1000);\r\n    const total = this.humanTime(duration * 1000);\r\n    const progress = (currentTime / duration) * 100;\r\n\r\n    return (\r\n      <div className={voiceClassName}>\r\n        <div className=\"voice row\">\r\n          <div className=\"voice__controls\">\r\n            {\r\n              !isLoaded\r\n                ? <i className=\"material-icons\" style={{ opacity: 0.3 }}>play_circle_filled</i>\r\n                : isPlaying\r\n                    ? <i className=\"material-icons\" onClick={this.handlePauseClick}>pause_circle_filled</i>\r\n                    : <i className=\"material-icons\" onClick={this.handlePlayClick}>play_circle_filled</i>\r\n            }\r\n          </div>\r\n          <div className=\"voice__body col-xs\">\r\n            <div className=\"row\">\r\n              <div className=\"col-xs text-left\">\r\n                <time className=\"voice__time voice__time--current\">{current}</time>\r\n              </div>\r\n              <div className=\"col-xs text-right\">\r\n                <time className=\"voice__time voice__time--total\">{total}</time>\r\n              </div>\r\n            </div>\r\n            {\r\n              isLoaded\r\n                ? <div className=\"voice__rewind\" onClick={this.handleRewind} ref=\"rewind\">\r\n                    <div className=\"played\" style={{ width: progress + '%' }}/>\r\n                  </div>\r\n                : <div className=\"voice__rewind voice__rewind--loading\"/>\r\n            }\r\n          </div>\r\n        </div>\r\n        <div className=\"col-xs\"/>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Voice;\r\n"]}