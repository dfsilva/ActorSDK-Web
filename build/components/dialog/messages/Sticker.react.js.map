{"version":3,"sources":["../../../../src/components/dialog/messages/Sticker.react.js"],"names":["cache","Sticker","props","state","isLoaded","isCached","calculateDementions","onLoad","bind","setCached","shouldComponentUpdate","setState","fileUrl","w","h","MAX_WIDTH","MAX_HEIGHT","width","height","renderPreloader","renderSticker","render","className","stickerClassName","propTypes","string","number","isRequired"],"mappings":"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","file":"Sticker.react.js","sourcesContent":["/*\r\n * Copyright (C) 2015 Actor LLC. <https://actor.im>\r\n */\r\n\r\nimport React, { Component, PropTypes } from 'react';\r\nimport classnames from 'classnames';\r\nimport { shouldComponentUpdate } from 'react-addons-pure-render-mixin';\r\n\r\nimport Image from '../../common/Image.react';\r\n\r\nlet cache = {};\r\n\r\n/**\r\n * Class that represents a component for display sticker message content\r\n */\r\nclass Sticker extends Component {\r\n  static propTypes = {\r\n    className: PropTypes.string,\r\n    fileUrl: PropTypes.string,\r\n    h: PropTypes.number.isRequired,\r\n    w: PropTypes.number.isRequired\r\n  };\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      isLoaded: this.isCached(),\r\n      ...this.calculateDementions()\r\n    }\r\n\r\n    this.onLoad = this.onLoad.bind(this);\r\n    this.isCached = this.isCached.bind(this);\r\n    this.setCached = this.setCached.bind(this);\r\n    this.shouldComponentUpdate = shouldComponentUpdate.bind(this);\r\n  }\r\n\r\n  onLoad() {\r\n    this.setCached();\r\n    if (!this.state.isLoaded) {\r\n      this.setState({ isLoaded: true });\r\n    }\r\n  }\r\n\r\n  isCached() {\r\n    return cache[this.props.fileUrl] === true;\r\n  }\r\n\r\n  setCached() {\r\n    cache[this.props.fileUrl] = true;\r\n  }\r\n\r\n  calculateDementions() {\r\n    const { w, h } = this.props;\r\n    const MAX_WIDTH = 200;\r\n    const MAX_HEIGHT = 200;\r\n\r\n    let width = w;\r\n    let height = h;\r\n\r\n    if (width > height) {\r\n      if (width > MAX_WIDTH) {\r\n        height *= MAX_WIDTH / width;\r\n        width = MAX_WIDTH;\r\n      }\r\n    } else {\r\n      if (height > MAX_HEIGHT) {\r\n        width *= MAX_HEIGHT / height;\r\n        height = MAX_HEIGHT;\r\n      }\r\n    }\r\n\r\n    return { width, height };\r\n  }\r\n\r\n  renderPreloader() {\r\n    const { isLoaded } = this.state;\r\n    if (isLoaded) return null;\r\n\r\n    return (\r\n      <div className=\"preloader\">\r\n        <div/><div/><div/><div/><div/>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  renderSticker() {\r\n    const { fileUrl } = this.props;\r\n    if (!fileUrl) return null;\r\n\r\n    const { width, height } = this.state;\r\n\r\n    return (\r\n      <Image\r\n        src={fileUrl}\r\n        width={width}\r\n        height={height}\r\n        onLoad={this.onLoad}\r\n      />\r\n    )\r\n  }\r\n\r\n  render() {\r\n    const { className } = this.props;\r\n    const { isLoaded, width, height } = this.state;\r\n    const stickerClassName = classnames('sticker', {\r\n      'sticker--loaded': isLoaded\r\n    });\r\n\r\n    return (\r\n      <div className={className}>\r\n        <div className={stickerClassName} style={{ width, height }}>\r\n          {this.renderPreloader()}\r\n          {this.renderSticker()}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Sticker;\r\n"]}