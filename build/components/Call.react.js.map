{"version":3,"sources":["../../src/components/Call.react.js"],"names":["Call","getStores","calculatePeerInfo","peer","type","USER","getUser","id","GROUP","getGroup","calculateState","call","getState","isOpen","isFloating","dialogPeer","getCurrentPeer","isSameDialog","equals","peerInfo","props","onAnswer","bind","onEnd","onMuteToggle","onClose","onFullscreen","onUserAdd","onVideo","shouldComponentUpdate","answerCall","state","endCall","toggleCallMute","hide","console","debug","renderContactInfo","render","isOutgoing","isMuted","create"],"mappings":"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","file":"Call.react.js","sourcesContent":["/*\r\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\r\n */\r\n\r\nimport React, { Component } from 'react';\r\nimport { shouldComponentUpdate } from 'react-addons-pure-render-mixin';\r\nimport { Container } from 'flux/utils';\r\n\r\nimport { PeerTypes } from '../constants/ActorAppConstants';\r\nimport PeerUtils from '../utils/PeerUtils';\r\n\r\nimport CallActionCreators from '../actions/CallActionCreators';\r\n\r\nimport CallStore from '../stores/CallStore';\r\nimport DialogStore from '../stores/DialogStore';\r\nimport UserStore from '../stores/UserStore';\r\nimport GroupStore from '../stores/GroupStore';\r\n\r\nimport CallBody from './call/CallBody.react';\r\nimport CallControls from './call/CallControls.react';\r\nimport ContactDetails from './common/ContactDetails.react';\r\n\r\nclass Call extends Component {\r\n  static getStores() {\r\n    return [CallStore, DialogStore];\r\n  }\r\n\r\n  static calculatePeerInfo(peer) {\r\n    if (peer) {\r\n      if (peer.type === PeerTypes.USER) {\r\n        return UserStore.getUser(peer.id);\r\n      }\r\n\r\n      if (peer.type === PeerTypes.GROUP) {\r\n        return GroupStore.getGroup(peer.id);\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  static calculateState() {\r\n    const call = CallStore.getState();\r\n    if (!call.isOpen || call.isFloating) {\r\n      return { isOpen: false };\r\n    }\r\n\r\n    const dialogPeer = DialogStore.getCurrentPeer();\r\n    const isSameDialog = PeerUtils.equals(dialogPeer, call.peer);\r\n    if (!isSameDialog) {\r\n      return { isOpen: false };\r\n    }\r\n\r\n    return {\r\n      call,\r\n      isOpen: true,\r\n      peerInfo: Call.calculatePeerInfo(call.peer)\r\n    };\r\n  }\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.onAnswer = this.onAnswer.bind(this);\r\n    this.onEnd = this.onEnd.bind(this);\r\n    this.onMuteToggle = this.onMuteToggle.bind(this);\r\n    this.onClose = this.onClose.bind(this);\r\n    this.onFullscreen = this.onFullscreen.bind(this);\r\n    this.onUserAdd = this.onUserAdd.bind(this);\r\n    this.onVideo = this.onVideo.bind(this);\r\n    this.shouldComponentUpdate = shouldComponentUpdate.bind(this);\r\n  }\r\n\r\n  onAnswer() {\r\n    CallActionCreators.answerCall(this.state.call.id);\r\n  }\r\n\r\n  onEnd() {\r\n    CallActionCreators.endCall(this.state.call.id);\r\n  }\r\n\r\n  onMuteToggle() {\r\n    CallActionCreators.toggleCallMute(this.state.call.id);\r\n  }\r\n\r\n  onClose() {\r\n    CallActionCreators.hide();\r\n  }\r\n\r\n  onFullscreen() {\r\n    console.debug('onFullscreen');\r\n  }\r\n\r\n  onUserAdd() {\r\n    console.debug('onUserAdd');\r\n  }\r\n\r\n  onVideo() {\r\n    console.debug('onVideo');\r\n  }\r\n\r\n  renderContactInfo() {\r\n    const { call, peerInfo } = this.state;\r\n    if (!peerInfo || call.peer.type === PeerTypes.GROUP) return null;\r\n\r\n    return (\r\n      <section className=\"call__info\">\r\n        <ContactDetails peerInfo={peerInfo}/>\r\n      </section>\r\n    )\r\n  }\r\n\r\n  render() {\r\n    const { isOpen, call, peerInfo } = this.state;\r\n    if (!isOpen) {\r\n      return <section className=\"activity\" />;\r\n    }\r\n\r\n    return (\r\n      <section className=\"activity activity--shown\">\r\n        <div className=\"activity__body call\">\r\n          <section className=\"call__container\">\r\n            <CallBody peerInfo={peerInfo} callState={call.state}/>\r\n            <CallControls\r\n              callState={call.state}\r\n              isOutgoing={call.isOutgoing}\r\n              isMuted={call.isMuted}\r\n              onEnd={this.onEnd}\r\n              onAnswer={this.onAnswer}\r\n              onMuteToggle={this.onMuteToggle}\r\n              onFullscreen={this.onFullscreen}\r\n              onUserAdd={this.onUserAdd}\r\n              onVideo={this.onVideo}\r\n              onClose={this.onClose}\r\n            />\r\n          </section>\r\n          {this.renderContactInfo()}\r\n        </div>\r\n      </section>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Container.create(Call);\r\n"]}