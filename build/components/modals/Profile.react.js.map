{"version":3,"sources":["../../../src/components/modals/Profile.react.js"],"names":["Profile","getStores","calculateState","prevState","state","getState","profile","name","nick","about","errors","props","context","handleClose","bind","handleSave","handleNameChange","handleNickChange","handleAboutChange","handleAvatarChange","hide","editMyName","editMyNick","editMyAbout","event","setState","target","value","validateNick","intl","length","messages","test","croppedImage","changeMyAvatar","handleAvatarRemove","removeMyAvatar","renderControls","renderName","renderNick","renderPhones","phones","map","phone","index","number","renderEmails","emails","email","renderAbout","render","PROFILE","contextTypes","object","create"],"mappings":"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","file":"Profile.react.js","sourcesContent":["/*\r\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\r\n */\r\n\r\nimport React, { Component, PropTypes } from 'react';\r\nimport { Container } from 'flux/utils';\r\nimport Modal from 'react-modal';\r\nimport { FormattedMessage } from 'react-intl';\r\nimport { ModalTypes } from '../../constants/ActorAppConstants';\r\n\r\nimport ProfileStore from '../../stores/ProfileStore';\r\n\r\nimport ProfileActionCreators from '../../actions/ProfileActionCreators';\r\n\r\nimport ModalCloseButton from './ModalCloseButton.react';\r\nimport TextField from '../common/TextField.react';\r\nimport PictureChanger from './profile/PictureChanger.react';\r\n\r\nclass Profile extends Component {\r\n  static getStores() {\r\n    return [ProfileStore];\r\n  }\r\n\r\n  static calculateState(prevState) {\r\n    const state = ProfileStore.getState();\r\n    return {\r\n      profile: state.profile,\r\n      name: prevState ? prevState.name : state.profile.name,\r\n      nick: prevState ? prevState.nick : state.profile.nick,\r\n      about: prevState ? prevState.about : state.profile.about,\r\n      errors: prevState ? prevState.errors : {}\r\n    };\r\n  }\r\n\r\n  static contextTypes = {\r\n    intl: PropTypes.object\r\n  };\r\n\r\n  constructor(props, context) {\r\n    super(props, context);\r\n\r\n    this.handleClose = this.handleClose.bind(this);\r\n    this.handleSave = this.handleSave.bind(this);\r\n    this.handleNameChange = this.handleNameChange.bind(this);\r\n    this.handleNickChange = this.handleNickChange.bind(this);\r\n    this.handleAboutChange = this.handleAboutChange.bind(this);\r\n    this.handleAvatarChange = this.handleAvatarChange.bind(this);\r\n  }\r\n\r\n  handleClose() {\r\n    ProfileActionCreators.hide();\r\n  }\r\n\r\n  handleSave() {\r\n    const { nick, name, about, profile, errors } = this.state;\r\n\r\n    if (!errors.nick) {\r\n      if (name !== profile.name) ProfileActionCreators.editMyName(name);\r\n      if (nick !== profile.nick) ProfileActionCreators.editMyNick(nick);\r\n      if (about !== profile.about) ProfileActionCreators.editMyAbout(about);\r\n      this.handleClose();\r\n    }\r\n  }\r\n\r\n  handleNameChange(event) {\r\n    this.setState({ name: event.target.value });\r\n  }\r\n\r\n  handleNickChange(event) {\r\n    const nick = event.target.value;\r\n\r\n    this.setState({\r\n      nick,\r\n      errors: {\r\n        nick: this.validateNick(nick)\r\n      }\r\n    });\r\n  }\r\n\r\n  validateNick(nick) {\r\n    const { intl } = this.context;\r\n\r\n    if (nick.length < 5 || nick.length > 32) {\r\n      return intl.messages['modal.profile.errors.nick.length'];\r\n    }\r\n\r\n    if (!/^[0-9a-zA-Z_]+$/.test(nick)) {\r\n      return intl.messages['modal.profile.errors.nick.chars'];\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  handleAboutChange(event) {\r\n    this.setState({ about: event.target.value });\r\n  }\r\n\r\n  handleAvatarChange(croppedImage) {\r\n    ProfileActionCreators.changeMyAvatar(croppedImage);\r\n  }\r\n\r\n  handleAvatarRemove() {\r\n    ProfileActionCreators.removeMyAvatar()\r\n  }\r\n\r\n  renderControls() {\r\n    const { errors } = this.state;\r\n\r\n    return (\r\n      <div className=\"controls\">\r\n        <button className=\"button\" onClick={this.handleClose}>\r\n          <FormattedMessage id=\"button.cancel\"/>\r\n        </button>\r\n        <button\r\n          className=\"button button--rised\"\r\n          disabled={errors.nick}\r\n          onClick={this.handleSave}>\r\n          <FormattedMessage id=\"button.save\"/>\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  renderName() {\r\n    const { name } = this.state;\r\n\r\n    return (\r\n      <div className=\"name\">\r\n        <TextField\r\n          className=\"input__material--wide\"\r\n          floatingLabel={<FormattedMessage id=\"modal.profile.name\"/>}\r\n          onChange={this.handleNameChange}\r\n          type=\"text\"\r\n          value={name}/>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  renderNick() {\r\n    const { nick, errors } = this.state;\r\n\r\n    return (\r\n      <div className=\"nick\">\r\n        <TextField\r\n          className=\"input__material--wide\"\r\n          floatingLabel={<FormattedMessage id=\"modal.profile.nick\"/>}\r\n          errorText={errors.nick}\r\n          onChange={this.handleNickChange}\r\n          type=\"text\"\r\n          value={nick}/>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  renderPhones() {\r\n    const { phones } = this.state.profile;\r\n    if (phones.length === 0) return null;\r\n\r\n    return phones.map((phone, index) => {\r\n      return (\r\n        <div className=\"phone\" key={`p${index}`}>\r\n          <TextField\r\n            className=\"input__material--wide\"\r\n            floatingLabel={<FormattedMessage id=\"modal.profile.phone\"/>}\r\n            disabled\r\n            type=\"tel\"\r\n            value={phone.number}/>\r\n        </div>\r\n      );\r\n    });\r\n  }\r\n\r\n  renderEmails() {\r\n    const { emails } = this.state.profile;\r\n    if (emails.length === 0) return null;\r\n\r\n    return emails.map((email, index) => {\r\n      return (\r\n        <div className=\"email\" key={`e${index}`}>\r\n          <TextField\r\n            className=\"input__material--wide\"\r\n            floatingLabel={<FormattedMessage id=\"modal.profile.email\"/>}\r\n            disabled\r\n            type=\"email\"\r\n            value={email.email}/>\r\n        </div>\r\n      );\r\n    });\r\n  }\r\n\r\n  renderAbout() {\r\n    const { about } = this.state;\r\n\r\n    return (\r\n      <div className=\"about\">\r\n        <label htmlFor=\"about\"><FormattedMessage id=\"modal.profile.about\"/></label>\r\n        <textarea\r\n          className=\"textarea\"\r\n          id=\"about\"\r\n          onChange={this.handleAboutChange}\r\n          value={about}/>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { profile } = this.state;\r\n\r\n    return (\r\n      <Modal\r\n        overlayClassName=\"modal-overlay modal-overlay--white\"\r\n        className=\"modal modal--fullscreen\"\r\n        onRequestClose={this.handleClose}\r\n        shouldCloseOnOverlayClick={false}\r\n        isOpen>\r\n\r\n        <ModalCloseButton onClick={this.handleClose}/>\r\n\r\n        <div className=\"profile\">\r\n          <div className=\"modal__content\">\r\n\r\n            <header className=\"modal__header\">\r\n              <FormattedMessage id=\"modal.profile.title\" tagName=\"h1\"/>\r\n            </header>\r\n\r\n            <div className=\"modal__body row\">\r\n              <div className=\"col-xs\">\r\n                {this.renderName()}\r\n                {this.renderNick()}\r\n                {this.renderPhones()}\r\n                {this.renderEmails()}\r\n                {this.renderAbout()}\r\n              </div>\r\n\r\n              <PictureChanger {...profile}\r\n                fromModal={ModalTypes.PROFILE}\r\n                onRemove={this.handleAvatarRemove}\r\n                onChange={this.handleAvatarChange}/>\r\n            </div>\r\n\r\n            <footer className=\"modal__footer\">\r\n              {this.renderControls()}\r\n            </footer>\r\n\r\n          </div>\r\n        </div>\r\n\r\n      </Modal>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Container.create(Profile);\r\n"]}