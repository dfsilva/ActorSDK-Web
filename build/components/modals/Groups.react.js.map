{"version":3,"sources":["../../../src/components/modals/Groups.react.js"],"names":["GroupList","getStores","calculateState","prevState","selectedIndex","list","getState","props","state","query","handleClose","bind","handleSearchChange","handleGroupSelect","handleKeyDown","handleScroll","componentDidMount","setFocus","document","addEventListener","componentWillUnmount","removeEventListener","refs","search","focus","close","event","target","value","setState","peer","peerStr","peerToString","push","results","getList","offset","index","selectNext","length","scrollContainerNode","selectedNode","selected","scrollContainerNodeRect","getBoundingClientRect","selectedNodeRect","top","height","scrollTop","selectPrev","scrollHeight","keyCode","ENTER","stopPropagation","preventDefault","peerInfo","ARROW_UP","ARROW_DOWN","TAB","shiftKey","filter","group","score","title","renderSearchInput","intl","context","messages","renderList","map","result","render","contextTypes","object","create","pure"],"mappings":"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","file":"Groups.react.js","sourcesContent":["/*\r\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\r\n */\r\n\r\nimport React, { Component, PropTypes } from 'react';\r\nimport Modal from 'react-modal';\r\nimport { findDOMNode } from 'react-dom';\r\nimport { Container } from 'flux/utils';\r\nimport { FormattedMessage, FormattedHTMLMessage } from 'react-intl';\r\nimport history from '../../utils/history';\r\nimport PeerUtils from '../../utils/PeerUtils';\r\nimport fuzzaldrin from 'fuzzaldrin';\r\n\r\nimport ModalCloseButton from './ModalCloseButton.react';\r\nimport { KeyCodes } from '../../constants/ActorAppConstants';\r\n\r\nimport GroupListActionCreators from '../../actions/GroupListActionCreators'\r\n\r\nimport GroupListStore from '../../stores/GroupListStore';\r\n\r\nimport Group from './groups/Group.react';\r\n\r\nclass GroupList extends Component {\r\n  static contextTypes = {\r\n    intl: PropTypes.object\r\n  };\r\n\r\n  static getStores() {\r\n    return [GroupListStore];\r\n  }\r\n\r\n  static calculateState(prevState) {\r\n    return {\r\n      ...prevState,\r\n      selectedIndex: 0,\r\n      list: GroupListStore.getState()\r\n    };\r\n  }\r\n\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      query: null,\r\n      selectedIndex: 0\r\n    }\r\n\r\n    this.handleClose = this.handleClose.bind(this);\r\n    this.handleSearchChange = this.handleSearchChange.bind(this);\r\n    this.handleGroupSelect = this.handleGroupSelect.bind(this);\r\n    this.handleKeyDown = this.handleKeyDown.bind(this);\r\n    this.handleScroll = this.handleScroll.bind(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.setFocus();\r\n    document.addEventListener('keydown', this.handleKeyDown, false);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    document.removeEventListener('keydown', this.handleKeyDown, false);\r\n  }\r\n\r\n  setFocus() {\r\n    findDOMNode(this.refs.search).focus()\r\n  }\r\n\r\n  handleClose() {\r\n    GroupListActionCreators.close();\r\n  }\r\n\r\n  handleSearchChange(event) {\r\n    const query = event.target.value;\r\n    this.setState({ query });\r\n  }\r\n\r\n  handleGroupSelect(peer) {\r\n    const peerStr = PeerUtils.peerToString(peer);\r\n    history.push(`/im/${peerStr}`);\r\n    this.handleClose()\r\n  }\r\n\r\n  handleKeyDown(event) {\r\n    const { selectedIndex } = this.state;\r\n    const results = this.getList();\r\n    const offset = 18;\r\n    let index = selectedIndex;\r\n\r\n    const selectNext = () => {\r\n      if (index < results.length - 1) {\r\n        index += 1;\r\n      } else if (index === results.length - 1) {\r\n        index = 0;\r\n      }\r\n\r\n      this.setState({ selectedIndex: index });\r\n\r\n      const scrollContainerNode = findDOMNode(this.refs.results);\r\n      const selectedNode = findDOMNode(this.refs.selected);\r\n      const scrollContainerNodeRect = scrollContainerNode.getBoundingClientRect();\r\n      const selectedNodeRect = selectedNode.getBoundingClientRect();\r\n\r\n      if ((scrollContainerNodeRect.top + scrollContainerNodeRect.height) < (selectedNodeRect.top + selectedNodeRect.height)) {\r\n        this.handleScroll(scrollContainerNode.scrollTop + (selectedNodeRect.top + selectedNodeRect.height) - (scrollContainerNodeRect.top + scrollContainerNodeRect.height) + offset);\r\n      } else if (scrollContainerNodeRect.top > selectedNodeRect.top) {\r\n        this.handleScroll(0);\r\n      }\r\n    };\r\n    const selectPrev = () => {\r\n      if (index > 0) {\r\n        index -= 1;\r\n      } else if (index === 0) {\r\n        index = results.length - 1;\r\n      }\r\n\r\n      this.setState({ selectedIndex: index });\r\n\r\n      const scrollContainerNode = findDOMNode(this.refs.results);\r\n      const selectedNode = findDOMNode(this.refs.selected);\r\n      const scrollContainerNodeRect = scrollContainerNode.getBoundingClientRect();\r\n      const selectedNodeRect = selectedNode.getBoundingClientRect();\r\n\r\n      if (scrollContainerNodeRect.top > selectedNodeRect.top) {\r\n        this.handleScroll(scrollContainerNode.scrollTop + selectedNodeRect.top - scrollContainerNodeRect.top - offset);\r\n      } else if (selectedNodeRect.top > (scrollContainerNodeRect.top + scrollContainerNodeRect.height)) {\r\n       this.handleScroll(scrollContainerNode.scrollHeight);\r\n      }\r\n    };\r\n\r\n    switch (event.keyCode) {\r\n      case KeyCodes.ENTER:\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n        this.handleGroupSelect(results[selectedIndex].peerInfo.peer);\r\n        break;\r\n\r\n      case KeyCodes.ARROW_UP:\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n        selectPrev();\r\n        break;\r\n      case KeyCodes.ARROW_DOWN:\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n        selectNext();\r\n        break;\r\n      case KeyCodes.TAB:\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n        if (event.shiftKey) {\r\n          selectPrev();\r\n        } else {\r\n          selectNext();\r\n        }\r\n        break;\r\n      default:\r\n    }\r\n  }\r\n\r\n  handleScroll(top) {\r\n    findDOMNode(this.refs.results).scrollTop = top;\r\n  }\r\n\r\n  getList() {\r\n    const { query, list } = this.state;\r\n\r\n    if (!query || query === '') return list;\r\n\r\n    return list.filter((group) => {\r\n      return fuzzaldrin.score(group.peerInfo.title, query) > 0;\r\n    });\r\n  }\r\n\r\n  renderSearchInput() {\r\n    const { query } = this.state;\r\n    const { intl } = this.context;\r\n\r\n    return (\r\n      <section className=\"large-search\">\r\n        <input className=\"input\"\r\n               onChange={this.handleSearchChange}\r\n               placeholder={intl.messages['modal.groups.search']}\r\n               type=\"search\"\r\n               ref=\"search\"\r\n               value={query}/>\r\n      </section>\r\n    );\r\n  }\r\n\r\n  renderList() {\r\n    const { query, selectedIndex, list } = this.state;\r\n    const results = this.getList();\r\n\r\n    if (list.length === 0) {\r\n      return (\r\n        <div className=\"result-list__item result-list__item--empty text-center\">\r\n          <FormattedMessage id=\"modal.groups.loading\"/>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    if (results.length === 0) {\r\n      return (\r\n        <div className=\"result-list__item result-list__item--empty text-center\">\r\n          <FormattedHTMLMessage id=\"modal.groups.notFound\" values={{ query }}/>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return results.map((result, index) => {\r\n      return (\r\n        <Group\r\n          group={result}\r\n          key={index}\r\n          isSelected={selectedIndex === index}\r\n          ref={selectedIndex === index ? 'selected' : null}\r\n          onClick={this.handleGroupSelect}\r\n          onMouseOver={() => this.setState({ selectedIndex: index })}\r\n        />\r\n      )\r\n    });\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Modal\r\n        overlayClassName=\"modal-overlay modal-overlay--white\"\r\n        className=\"modal modal--fullscreen modal--without-scroll\"\r\n        onRequestClose={this.handleClose}\r\n        shouldCloseOnOverlayClick={false}\r\n        isOpen>\r\n\r\n        <ModalCloseButton onClick={this.handleClose}/>\r\n\r\n        <div className=\"group-list\">\r\n          <div className=\"modal__content\">\r\n\r\n            <header className=\"modal__header\">\r\n              <FormattedMessage id=\"modal.groups.title\" tagName=\"h1\"/>\r\n            </header>\r\n\r\n            {this.renderSearchInput()}\r\n\r\n            <div className=\"modal__body\" ref=\"results\">\r\n              <div className=\"result-list\">\r\n                {this.renderList()}\r\n              </div>\r\n            </div>\r\n\r\n          </div>\r\n        </div>\r\n\r\n      </Modal>\r\n    )\r\n  }\r\n}\r\n\r\nexport default Container.create(GroupList, { pure: false });\r\n"]}