{"version":3,"sources":["../../src/actions/LoginActionCreators.js"],"names":["LoginActionCreators","start","AUTH_START","changeLogin","login","AUTH_CHANGE_LOGIN","changeCode","code","AUTH_CHANGE_CODE","changeName","name","AUTH_CHANGE_NAME","startSignup","AUTH_SIGNUP_START","restartAuth","AUTH_RESTART","toogleLoginType","AUTH_TOOGLE_LOGIN_TYPE","requestCode","phone","promise","test","requestCodeEmail","requestSms","request","AUTH_CODE_REQUEST","success","AUTH_CODE_REQUEST_SUCCESS","failure","AUTH_CODE_REQUEST_FAILURE","sendCode","AUTH_CODE_SEND","AUTH_CODE_SEND_SUCCESS","AUTH_CODE_SEND_FAILURE","then","state","setLoggedIn","redirect","console","error","sendSignup","signUpPromise","signUp","AUTH_SIGNUP","AUTH_SIGNUP_SUCCESS","AUTH_SIGNUP_FAILURE","opts","delegate","get","actions","location","nextPathname","replace","setBindings","bindUser","getUid","setProfile","bindGroupDialogs","setDialogs","bindContacts","setContacts","bindSearch","setQuickSearchList","bindTempGlobalCounter","setFavicon","bindEventBus","broadcastEvent","bindStickers","setStickers","AUTH_SET_LOGGED_IN","joinAfterLogin","setLoggedOut","removeBindings","AUTH_SET_LOGGED_OUT"],"mappings":"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","file":"LoginActionCreators.js","sourcesContent":["/*\r\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\r\n */\r\n\r\nimport { dispatch, dispatchAsync } from '../dispatcher/ActorAppDispatcher';\r\nimport { ActionTypes } from '../constants/ActorAppConstants';\r\n\r\nimport ActorClient from '../utils/ActorClient';\r\nimport history from '../utils/history';\r\nimport DelegateContainer from '../utils/DelegateContainer';\r\nimport LocationContainer from '../utils/LocationContainer';\r\n\r\nimport ActionCreators from './ActionCreators';\r\nimport JoinGroupActions from './JoinGroupActions';\r\nimport ProfileActionCreators from './ProfileActionCreators';\r\nimport DialogActionCreators from './DialogActionCreators';\r\nimport ContactActionCreators from './ContactActionCreators';\r\nimport QuickSearchActionCreators from './QuickSearchActionCreators';\r\nimport FaviconActionCreators from './FaviconActionCreators';\r\nimport EventBusActionCreators from './EventBusActionCreators';\r\nimport StickersActionCreators from './StickersActionCreators';\r\n\r\nclass LoginActionCreators extends ActionCreators {\r\n  start() {\r\n    dispatch(ActionTypes.AUTH_START);\r\n  }\r\n\r\n  changeLogin(login) {\r\n    dispatch(ActionTypes.AUTH_CHANGE_LOGIN, { login });\r\n  }\r\n\r\n  changeCode(code) {\r\n    dispatch(ActionTypes.AUTH_CHANGE_CODE, { code });\r\n  }\r\n\r\n  changeName(name) {\r\n    dispatch(ActionTypes.AUTH_CHANGE_NAME, { name });\r\n  }\r\n\r\n  startSignup() {\r\n    dispatch(ActionTypes.AUTH_SIGNUP_START);\r\n  }\r\n\r\n  restartAuth() {\r\n    dispatch(ActionTypes.AUTH_RESTART);\r\n  }\r\n\r\n  restartAuth() {\r\n      dispatch(ActionTypes.AUTH_RESTART);\r\n  }\r\n\r\n  toogleLoginType(){\r\n    dispatch(ActionTypes.AUTH_TOOGLE_LOGIN_TYPE);\r\n  }\r\n\r\n  requestCode(phone) {\r\n    let promise;\r\n    if (/@/.test(phone)) {\r\n      promise = ActorClient.requestCodeEmail(phone);\r\n    } else {\r\n      promise = ActorClient.requestSms(phone);\r\n    }\r\n\r\n    dispatchAsync(promise, {\r\n      request: ActionTypes.AUTH_CODE_REQUEST,\r\n      success: ActionTypes.AUTH_CODE_REQUEST_SUCCESS,\r\n      failure: ActionTypes.AUTH_CODE_REQUEST_FAILURE\r\n    }, { phone });\r\n  }\r\n\r\n  requestSms(phone) {\r\n    dispatchAsync(ActorClient.requestSms(phone), {\r\n      request: ActionTypes.AUTH_CODE_REQUEST,\r\n      success: ActionTypes.AUTH_CODE_REQUEST_SUCCESS,\r\n      failure: ActionTypes.AUTH_CODE_REQUEST_FAILURE\r\n    }, { phone });\r\n  }\r\n\r\n  sendCode(code) {\r\n    dispatchAsync(ActorClient.sendCode(code), {\r\n      request: ActionTypes.AUTH_CODE_SEND,\r\n      success: ActionTypes.AUTH_CODE_SEND_SUCCESS,\r\n      failure: ActionTypes.AUTH_CODE_SEND_FAILURE\r\n    }, {\r\n      code\r\n    }).then((state) => {\r\n      switch (state) {\r\n        case 'signup':\r\n          this.startSignup();\r\n          break;\r\n        case 'start':\r\n            this.startSignup();\r\n            break;\r\n        case 'logged_in':\r\n          this.setLoggedIn({ redirect: true });\r\n          break;\r\n        default:\r\n          console.error('Unsupported state', state);\r\n      }\r\n    });\r\n  }\r\n\r\n  sendSignup(name) {\r\n    const signUpPromise = () => dispatchAsync(ActorClient.signUp(name), {\r\n      request: ActionTypes.AUTH_SIGNUP,\r\n      success: ActionTypes.AUTH_SIGNUP_SUCCESS,\r\n      failure: ActionTypes.AUTH_SIGNUP_FAILURE\r\n    }, { name });\r\n\r\n    const setLoggedIn = () => this.setLoggedIn({ redirect: true });\r\n\r\n    signUpPromise()\r\n      .then(setLoggedIn)\r\n  }\r\n\r\n  setLoggedIn(opts = {}) {\r\n    const delegate = DelegateContainer.get();\r\n\r\n    if (delegate.actions.setLoggedIn) {\r\n      return delegate.actions.setLoggedIn(opts);\r\n    }\r\n\r\n    if (opts.redirect) {\r\n      const location = LocationContainer.get();\r\n      const nextPathname = location.state ? location.state.nextPathname : '/';\r\n\r\n      history.replace(nextPathname);\r\n    }\r\n\r\n    this.setBindings('main', [\r\n      ActorClient.bindUser(ActorClient.getUid(), ProfileActionCreators.setProfile),\r\n      ActorClient.bindGroupDialogs(DialogActionCreators.setDialogs),\r\n      ActorClient.bindContacts(ContactActionCreators.setContacts),\r\n      ActorClient.bindSearch(QuickSearchActionCreators.setQuickSearchList),\r\n      ActorClient.bindTempGlobalCounter(FaviconActionCreators.setFavicon),\r\n      ActorClient.bindEventBus(EventBusActionCreators.broadcastEvent),\r\n      ActorClient.bindStickers(StickersActionCreators.setStickers)//,\r\n      //ActorClient.bindGroups(GroupListActionCreators.setGroups),\r\n      //ActorClient.bindChannels(ChannelsActionCreators.setChannels)\r\n    ]);\r\n\r\n    dispatch(ActionTypes.AUTH_SET_LOGGED_IN);\r\n\r\n    JoinGroupActions.joinAfterLogin();\r\n  }\r\n\r\n  setLoggedOut() {\r\n    const delegate = DelegateContainer.get();\r\n\r\n    if (delegate.actions.setLoggedOut) {\r\n      return delegate.actions.setLoggedOut();\r\n    }\r\n\r\n    this.removeBindings('main');\r\n\r\n    dispatch(ActionTypes.AUTH_SET_LOGGED_OUT);\r\n  }\r\n}\r\n\r\nexport default new LoginActionCreators();\r\n"]}