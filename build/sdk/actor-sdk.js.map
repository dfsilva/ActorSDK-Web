{"version":3,"sources":["../../src/sdk/actor-sdk.js"],"names":["ACTOR_INIT_EVENT","start","ajax","restartOnRequestAfter","restartOnPushState","load","animation","controlClose","window","isJsAppLoaded","jsAppLoaded","ActorSDK","options","_starter","supported","on","msg","origin","id","location","hash","push","appRootElemet","document","getElementById","rootElement","broadcast","messenger","create","endpoints","logHandler","intlData","forceLocale","createElement","Component","props","delegate","isExperimental","root","getRoutes","setAppElement","isLoggedIn","setLoggedIn","redirect","defaultOptions","set","l18n","routes","Login","components","login","Deactivated","deactivated","Install","install","Archive","archive","Join","join","Empty","empty","Dialog","dialog","GroupPre","grouppre","requireAuth","startApp","appName","helpPhone","homePage","twitter","facebook","features","calls","search","editing","loginType","EMAIL_PHONE"],"mappings":"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","file":"actor-sdk.js","sourcesContent":["/*\r\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\r\n */\r\n\r\nimport 'babel-polyfill';\r\nimport 'setimmediate';\r\nimport 'intl';\r\n\r\nimport Actor from 'actor-js';\r\nimport React from 'react';\r\nimport { render } from 'react-dom';\r\nimport { Router, Route, IndexRoute, Redirect, IndexRedirect } from 'react-router';\r\nimport Modal from 'react-modal';\r\nimport Pace from 'pace';\r\nimport crosstab from 'crosstab';\r\nimport assignDeep from 'assign-deep';\r\n\r\nimport DelegateContainer from '../utils/DelegateContainer';\r\nimport SharedContainer from '../utils/SharedContainer';\r\nimport SDKDelegate from './actor-sdk-delegate';\r\nimport { endpoints, rootElement, helpPhone, appName, LoginTypes } from '../constants/ActorAppConstants'\r\n\r\nimport history from '../utils/history';\r\nimport RouterHooks from '../utils/RouterHooks';\r\nimport { IntlProvider } from 'react-intl';\r\nimport { lightbox } from '../utils/ImageUtils'\r\n\r\nimport LoginActionCreators from '../actions/LoginActionCreators';\r\nimport defaultLogHandler from '../utils/defaultLogHandler';\r\n\r\nimport LoginStore from '../stores/LoginStore';\r\n\r\nimport App from '../components/App.react';\r\nimport Main from '../components/Main.react';\r\nimport DefaultLogin from '../components/Login.react';\r\nimport DefaultDeactivated from '../components/Deactivated.react';\r\nimport DefaultJoin from '../components/Join.react';\r\nimport DefaultInstall from '../components/Install.react';\r\nimport DefaultArchive from '../components/Archive.react';\r\nimport DefaultDialog from '../components/Dialog.react';\r\nimport DefaultEmpty from '../components/Empty.react';\r\nimport DefaultGrouppre from '../components/Grouppre.react';\r\n\r\nimport { extendL18n, getIntlData } from '../l18n';\r\n\r\nconst ACTOR_INIT_EVENT = 'INIT';\r\n\r\n// Init app loading progressbar\r\nPace.start({\r\n  ajax: false,\r\n  restartOnRequestAfter: false,\r\n  restartOnPushState: false\r\n});\r\n\r\n// Init lightbox\r\nlightbox.load({\r\n  animation: false,\r\n  controlClose: '<i class=\"material-icons\">close</i>'\r\n});\r\n\r\nwindow.isJsAppLoaded = false;\r\nwindow.jsAppLoaded = () => window.isJsAppLoaded = true;\r\n\r\n/**\r\n * Class represents ActorSKD itself\r\n *\r\n * @param {object} options - Object contains custom components, actions and localisation strings.\r\n */\r\nclass ActorSDK {\r\n  static defaultOptions = {\r\n    endpoints,\r\n    rootElement,\r\n    appName,\r\n    helpPhone,\r\n    homePage: null,\r\n    twitter: null,\r\n    facebook: null,\r\n    delegate: null,\r\n    forceLocale: null,\r\n    features: {\r\n      calls: true,\r\n      search: false,\r\n      editing: false\r\n    },\r\n    routes: null,\r\n    isExperimental: false,\r\n    loginType: LoginTypes.EMAIL_PHONE,\r\n    logHandler: defaultLogHandler\r\n  };\r\n\r\n  constructor(options = {}) {\r\n    assignDeep(this, ActorSDK.defaultOptions, options);\r\n\r\n    if (!this.delegate) {\r\n      this.delegate = new SDKDelegate();\r\n    }\r\n\r\n    DelegateContainer.set(this.delegate);\r\n\r\n    if (this.delegate.l18n) extendL18n();\r\n\r\n    SharedContainer.set(this);\r\n  }\r\n\r\n  getRoutes() {\r\n    if (this.routes) {\r\n      return this.routes;\r\n    }\r\n\r\n    const Login = (typeof this.delegate.components.login == 'function') ? this.delegate.components.login : DefaultLogin;\r\n    const Deactivated = (typeof this.delegate.components.deactivated == 'function') ? this.delegate.components.deactivated : DefaultDeactivated;\r\n    const Install = (typeof this.delegate.components.install == 'function') ? this.delegate.components.install : DefaultInstall;\r\n    const Archive = (typeof this.delegate.components.archive == 'function') ? this.delegate.components.archive : DefaultArchive; // TODO: Rename this component\r\n    const Join = (typeof this.delegate.components.join == 'function') ? this.delegate.components.join : DefaultJoin;\r\n    const Empty = (typeof this.delegate.components.empty == 'function') ? this.delegate.components.empty : DefaultEmpty;\r\n    const Dialog = (typeof this.delegate.components.dialog == 'function') ? this.delegate.components.dialog : DefaultDialog;\r\n    const GroupPre = (typeof this.delegate.components.grouppre == 'function') ? this.delegate.components.grouppre : DefaultGrouppre;\r\n\r\n    return (\r\n      <Route path=\"/\" component={App}>\r\n        <Route path=\"auth\" component={Login}/>\r\n        <Route path=\"deactivated\" component={Deactivated}/>\r\n        <Route path=\"install\" component={Install}/>\r\n\r\n        <Route path=\"im\" component={Main} onEnter={RouterHooks.requireAuth}>\r\n          <Route path=\"history\" component={Archive} />\r\n          <Route path=\"groups-pre\" component={GroupPre}/>\r\n          <Route path=\"join/:token\" component={Join} />\r\n          <Route path=\":id\" component={Dialog} />\r\n          <IndexRoute component={Empty} />\r\n        </Route>\r\n\r\n        <Redirect from=\"join/:token\" to=\"im/join/:token\" />\r\n        <IndexRedirect to=\"im\"/>\r\n      </Route>\r\n    );\r\n  }\r\n\r\n  _starter = () => {\r\n    if (crosstab.supported) {\r\n      crosstab.on(ACTOR_INIT_EVENT, (msg) => {\r\n        if (msg.origin !== crosstab.id && window.location.hash !== '#/deactivated') {\r\n          history.push('deactivated');\r\n        }\r\n      });\r\n    }\r\n\r\n    const appRootElemet = document.getElementById(this.rootElement);\r\n\r\n    if (window.location.hash !== '#/deactivated') {\r\n      if (crosstab.supported) crosstab.broadcast(ACTOR_INIT_EVENT, {});\r\n      window.messenger = Actor.create({\r\n        endpoints: this.endpoints,\r\n        logHandler: this.logHandler\r\n      });\r\n    }\r\n\r\n    const intlData = getIntlData(this.forceLocale);\r\n\r\n    /**\r\n     * Method for pulling props to router components\r\n     *\r\n     * @param RoutedComponent component for extending\r\n     * @param props props to extend\r\n     * @returns {object} extended component\r\n     */\r\n    const createElement = (Component, props) => {\r\n      return <Component {...props} delegate={this.delegate} isExperimental={this.isExperimental}/>;\r\n    };\r\n\r\n    const root = (\r\n      <IntlProvider {...intlData}>\r\n        <Router history={history} createElement={createElement}>\r\n          {this.getRoutes()}\r\n        </Router>\r\n      </IntlProvider>\r\n    );\r\n\r\n    render(root, appRootElemet);\r\n\r\n    // initial setup fot react modal\r\n    Modal.setAppElement(appRootElemet);\r\n\r\n    if (window.location.hash !== '#/deactivated') {\r\n      if (LoginStore.isLoggedIn()) LoginActionCreators.setLoggedIn({ redirect: false });\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Start application\r\n   */\r\n  startApp() {\r\n    if (window.isJsAppLoaded) {\r\n      this._starter();\r\n    } else {\r\n      window.jsAppLoaded = this._starter;\r\n    }\r\n  }\r\n}\r\n\r\nexport default ActorSDK;\r\n"]}