{"version":3,"sources":["../../src/sdk/actor-sdk.js"],"names":["ACTOR_INIT_EVENT","start","ajax","restartOnRequestAfter","restartOnPushState","load","animation","controlClose","window","isJsAppLoaded","jsAppLoaded","ActorSDK","options","_starter","supported","on","msg","origin","id","location","hash","push","appRootElemet","document","getElementById","rootElement","broadcast","messenger","create","endpoints","logHandler","intlData","forceLocale","createElement","Component","props","delegate","isExperimental","root","getRoutes","setAppElement","isLoggedIn","setLoggedIn","redirect","defaultOptions","set","l18n","routes","Login","components","login","Deactivated","deactivated","Install","install","Archive","archive","Join","join","Empty","empty","Dialog","dialog","requireAuth","startApp","appName","helpPhone","homePage","twitter","facebook","features","calls","search","editing"],"mappings":"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","file":"actor-sdk.js","sourcesContent":["/*\n * Copyright (C) 2015-2016 Actor LLC. <https://actor.im>\n */\n\nimport 'babel-polyfill';\nimport 'setimmediate';\nimport 'intl';\n\nimport Actor from 'actor-js';\nimport React from 'react';\nimport { render } from 'react-dom';\nimport { Router, Route, IndexRoute, Redirect, IndexRedirect } from 'react-router';\nimport Modal from 'react-modal';\nimport Pace from 'pace-progress';\nimport crosstab from 'crosstab';\nimport assignDeep from 'assign-deep';\n\nimport DelegateContainer from '../utils/DelegateContainer';\nimport SharedContainer from '../utils/SharedContainer';\nimport SDKDelegate from './actor-sdk-delegate';\nimport { endpoints, rootElement, helpPhone, appName } from '../constants/ActorAppConstants'\n\nimport history from '../utils/history';\nimport RouterHooks from '../utils/RouterHooks';\nimport { IntlProvider } from 'react-intl';\nimport { lightbox } from '../utils/ImageUtils'\n\nimport LoginActionCreators from '../actions/LoginActionCreators';\nimport defaultLogHandler from '../utils/defaultLogHandler';\n\nimport LoginStore from '../stores/LoginStore';\n\nimport App from '../components/App.react';\nimport Main from '../components/Main.react';\nimport DefaultLogin from '../components/Login.react';\nimport DefaultDeactivated from '../components/Deactivated.react';\nimport DefaultJoin from '../components/Join.react';\nimport DefaultInstall from '../components/Install.react';\nimport DefaultArchive from '../components/Archive.react';\nimport DefaultDialog from '../components/Dialog.react';\nimport DefaultEmpty from '../components/Empty.react';\n\nimport { extendL18n, getIntlData } from '../l18n';\n\nconst ACTOR_INIT_EVENT = 'INIT';\n\n// Init app loading progressbar\nPace.start({\n  ajax: false,\n  restartOnRequestAfter: false,\n  restartOnPushState: false\n});\n\n// Init lightbox\nlightbox.load({\n  animation: false,\n  controlClose: '<i class=\"material-icons\">close</i>'\n});\n\nwindow.isJsAppLoaded = false;\nwindow.jsAppLoaded = () => window.isJsAppLoaded = true;\n\n/**\n * Class represents ActorSKD itself\n *\n * @param {object} options - Object contains custom components, actions and localisation strings.\n */\nclass ActorSDK {\n  static defaultOptions = {\n    endpoints,\n    rootElement,\n    appName,\n    helpPhone,\n    homePage: null,\n    twitter: null,\n    facebook: null,\n    delegate: null,\n    forceLocale: null,\n    features: {\n      calls: true,\n      search: false,\n      editing: false\n    },\n    routes: null,\n    isExperimental: false,\n    logHandler: defaultLogHandler\n  };\n\n  constructor(options = {}) {\n    assignDeep(this, ActorSDK.defaultOptions, options);\n\n    if (!this.delegate) {\n      this.delegate = new SDKDelegate();\n    }\n\n    DelegateContainer.set(this.delegate);\n\n    if (this.delegate.l18n) extendL18n();\n\n    SharedContainer.set(this);\n  }\n\n  getRoutes() {\n    if (this.routes) {\n      return this.routes;\n    }\n\n    const Login = (typeof this.delegate.components.login == 'function') ? this.delegate.components.login : DefaultLogin;\n    const Deactivated = (typeof this.delegate.components.deactivated == 'function') ? this.delegate.components.deactivated : DefaultDeactivated;\n    const Install = (typeof this.delegate.components.install == 'function') ? this.delegate.components.install : DefaultInstall;\n    const Archive = (typeof this.delegate.components.archive == 'function') ? this.delegate.components.archive : DefaultArchive; // TODO: Rename this component\n    const Join = (typeof this.delegate.components.join == 'function') ? this.delegate.components.join : DefaultJoin;\n    const Empty = (typeof this.delegate.components.empty == 'function') ? this.delegate.components.empty : DefaultEmpty;\n    const Dialog = (typeof this.delegate.components.dialog == 'function') ? this.delegate.components.dialog : DefaultDialog;\n\n    return (\n      <Route path=\"/\" component={App}>\n        <Route path=\"auth\" component={Login}/>\n        <Route path=\"deactivated\" component={Deactivated}/>\n        <Route path=\"install\" component={Install}/>\n\n        <Route path=\"im\" component={Main} onEnter={RouterHooks.requireAuth}>\n          <Route path=\"history\" component={Archive} />\n          <Route path=\"join/:token\" component={Join} />\n          <Route path=\":id\" component={Dialog} />\n          <IndexRoute component={Empty} />\n        </Route>\n\n        <Redirect from=\"join/:token\" to=\"im/join/:token\" />\n        <IndexRedirect to=\"im\"/>\n      </Route>\n    );\n  }\n\n  _starter = () => {\n    if (crosstab.supported) {\n      crosstab.on(ACTOR_INIT_EVENT, (msg) => {\n        if (msg.origin !== crosstab.id && window.location.hash !== '#/deactivated') {\n          history.push('deactivated');\n        }\n      });\n    }\n\n    const appRootElemet = document.getElementById(this.rootElement);\n\n    if (window.location.hash !== '#/deactivated') {\n      if (crosstab.supported) crosstab.broadcast(ACTOR_INIT_EVENT, {});\n      window.messenger = Actor.create({\n        endpoints: this.endpoints,\n        logHandler: this.logHandler\n      });\n    }\n\n    const intlData = getIntlData(this.forceLocale);\n\n    /**\n     * Method for pulling props to router components\n     *\n     * @param RoutedComponent component for extending\n     * @param props props to extend\n     * @returns {object} extended component\n     */\n    const createElement = (Component, props) => {\n      return <Component {...props} delegate={this.delegate} isExperimental={this.isExperimental}/>;\n    };\n\n    const root = (\n      <IntlProvider {...intlData}>\n        <Router history={history} createElement={createElement}>\n          {this.getRoutes()}\n        </Router>\n      </IntlProvider>\n    );\n\n    render(root, appRootElemet);\n\n    // initial setup fot react modal\n    Modal.setAppElement(appRootElemet);\n\n    if (window.location.hash !== '#/deactivated') {\n      if (LoginStore.isLoggedIn()) LoginActionCreators.setLoggedIn({ redirect: false });\n    }\n  };\n\n  /**\n   * Start application\n   */\n  startApp() {\n    if (window.isJsAppLoaded) {\n      this._starter();\n    } else {\n      window.jsAppLoaded = this._starter;\n    }\n  }\n}\n\nexport default ActorSDK;\n"]}